%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Iniciales
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[letterpaper, 10pt]{article}
%\usepackage{settings}
%\usepackage{./settings}
\input{settings.sty}

\addto\captionsspanish{\renewcommand{\contentsname}{Índice de contenidos}}
\addbibresource{ref.bib}

\begin{document}
\setlength{\parindent}{0cm} % Dar indentación a primera línea del parrafo
% Cambia el nombre cuadro por tabla
\renewcommand{\listtablename}{Índice de tablas} % Originalmente se llama Indice de cuadros
\renewcommand{\tablename}{Tabla} % Originalmente se llama Cuadro


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Encabezado
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Portada
\begin{titlepage}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.17\textwidth]{logo.pdf}
\end{figure}

\begin{center}
{\sc Pontificia Universidad Cat\'olica de Chile\\
Escuela de Ingenier\'ia\\
Departamento de Ingenier\'ia Eléctrica}\\
\end{center}

\phantom{""}\vspace{35mm}

\noindent\makebox[\linewidth]{\rule{\textwidth}{0.6pt}}\


\begin{center}
    \huge{\textbf{Programación de plataforma docente para accionamiento de un motor PMSM}}\\
    \noindent\makebox[\linewidth]{\rule{\textwidth}{0.6pt}}\vspace{5mm}
    \large{IEE2985 - Investigación en Pregrado}
    \vspace{10mm}
    \noindent\makebox[\linewidth]{\rule{\textwidth}{0.6pt}}
    \vspace{30mm}
\end{center}

%\begin{flushright}
\large
Alumno: Vicente Morales\\
Profesor: Javier Pereda PhD \\
Semestre: 2025-2
%\end{flushright}



\end{titlepage}
\pagebreak

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Índices
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage 
\begingroup
\hypersetup{linkcolor=black}
\tableofcontents

\newpage
\listoffigures

\bigskip
\listoftables
\endgroup

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Descripción de la investigación
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Descripción de la investigación propuesta}
El trabajo consiste en reprogramar el control de campo orientado (FOC: Field Oriented Control) de un motor PMSM que ya está implementado en una plataforma enfocada en actividades docentes. Todo el \textit{hardware} se encuentra disponible y funcionando, pero el control no funciona correctamente aún.

La programación del microcontrolador LAUNCHXL-F28379D se realiza a través del Target Support Package (extensión de PLECS Standalone que permite generar código para microcontroladores).

Plataforma de control: LAUNCHXL-F28379D
Inversor trifásico: BOOSTXL-3PhGaNInv
Motor: BLWS232D-24V-4000




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Conceptos generales
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Conceptos preliminares}

Un \textit{accionamiento eléctrico} convierte energía eléctrica en energía mecánica para realizar un trabajo útil, manteniendo bajo control el proceso de conversión \cite{FraileMora}. En su arquitectura típica (ver \autoref{fig:esquema_general}), la red alimenta a través de un convertidor electrónico a una máquina eléctrica que acciona la carga —directamente o mediante transmisión— mientras un sistema de medida realimenta variables al controlador, que actúa sobre el convertidor para satisfacer los requisitos de par y velocidad.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.65\linewidth]{figuras_preliminar/general.png}
    \caption{Arquitectura funcional de un accionamiento eléctrico \cite{FraileMora}.}
    \label{fig:esquema_general}
\end{figure}

Aunque el flujo de energía suele ir de la red a la carga (\textit{modo motor}), en numerosas aplicaciones puede invertirse para devolver energía a la fuente (\textit{modo generador}). Los accionamientos modernos emplean electrónica de potencia y control digital para regular esta conversión con alta eficiencia y respuesta dinámica.

En la automatización industrial, los \textit{variadores de velocidad} (VFD) son una pieza clave para ajustar procesos, mejorar el rendimiento y reducir consumo y costos energéticos. Entre los tipos de VFD (eléctricos, hidráulicos y mecánicos), los eléctricos destacan por su versatilidad y amplio uso en ventiladores y bombas, compresores, herramientas y robots, bancadas de prueba, papel y celulosa, tracción y propulsión naval, cementeras y trenes de laminación \cite{rashid_book}. La \autoref{fig:clasificacion_general} muestra algunas de las principales formas de clasificar los VFD eléctricos.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\linewidth]{figuras_preliminar/clasificacion_rashid.png}
    \caption{Clasificación de los VFD \cite{rashid_book}.}
    \label{fig:clasificacion_general}
\end{figure}

De la tabla, es importante tener en cuenta que el tipo de accionamiento empleado depende del tipo de motor eléctrico a controlar, dado que esto impacta sobre el tipo de convertidor electrónico empleado. Los distintos tipos de convertidores empleados para distintos tipos de máquinas tradicionalmente utilizadas en la industria se muestran en la \autoref{fig:clasificacion_convertidores}.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{figuras_preliminar/vsd_types_rashid.png}
    \caption{Tipos de convertidores electrónicos dependiendo del tipo de máquina \cite{rashid_book}.}
    \label{fig:clasificacion_convertidores}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Equipos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Equipos considerados}
El alcance de esta investigación considera el control de un motor trifásico de imanes permanentes en el rotor, accionado mediante un inversor tipo fuente de voltaje (VSI) implementado como puente trifásico con transistores MOSFET. El inversor se conecta directamente a las bobinas del estator de la máquina.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.62\linewidth]{figuras_equipos/conexion_general.png}
    \caption{Conexión entre el convertidor y la máquina estudiada.}
    \label{fig:conexion_general}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\medskip
\subsection{Motor trifásico}
El motor seleccionado es un \textit{brushless DC} (BLDC) modelo BLWS232D-24V-4000 del fabricante Anaheim Automation. Es un motor síncrono con dos pares de polos, imanes permanentes en el rotor interno y bobinados del estator conectados en delta, como se muestra en la \autoref{fig:configuracion_motor}.

\bigskip
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.3\linewidth}
    \centering
    \includegraphics[width=0.85\linewidth]{figuras_equipos/BLDC_real.png}
    \caption{Motor estudiado \cite{anaheim_BLWS23_datasheet}.}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.3\linewidth}
    \centering
    \includegraphics[width=0.87\linewidth]{figuras_equipos/BLDC_esquema2.png}
    \caption{Esquema del motor de dos pares de polos \cite{twmotor_bldc_2024}.}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.3\linewidth}
    \centering
    \includegraphics[width=0.95\linewidth]{figuras_equipos/delta_connection.jpg}
    \caption{Conexión en delta de las bobinas del estator (stock).}
  \end{subfigure}
  \caption{Configuración del motor BLWS232D-24V-4000.}
  \label{fig:configuracion_motor}
\end{figure}
A continuación, se resumen los parámetros principales reportados en la hoja de datos \cite{anaheim_BLWS23_datasheet}:

\begin{multicols}{2}
\begin{itemize}
    \item Voltaje nominal: 24 [V]
    \item Velocidad nominal: 4000 [rpm]
    \item Potencia nominal: 46 [W]
    \item Torque nominal: 0.11 [N-m]
    \item Pares de polos: 2
    \item Constante de torque: 0.0387 [N-m/A]
    \item Voltaje de back-EMF: 0.004 [V/rpm]
    \item Resistencia línea - línea: 0.82 [$\Omega$]
    \item Inductancia línea - línea: 2.3 [mH]
    \item Inercia rotórica: $7.485\cdot 10^{-6}$ [N-m-s$^2$]
\end{itemize}
\end{multicols}

El motor dispone de tres terminales (A, B, C) para su alimentación y control desde el inversor.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Sensor de posición: sensor \textit{Hall}}
El motor Anaheim incorpora tres sensores Hall digitales montados a \(120^\circ\) eléctricos entre sí, solidarios al estator y enfrentados al rotor de imanes permanentes. Las tres salidas, \(\mathrm{H1}\), \(\mathrm{H2}\) y \(\mathrm{H3}\), se cablean junto con los conductores del motor, más alimentación a $5V$ y tierra (GND). Cada canal entrega una señal cuadrada compatible con lógica de $5V$.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.4\linewidth]{figuras_equipos/hall_ubicacion.jpg}
  \caption{Ubicación típica de los sensores Hall respecto del rotor (referencial).}
\end{figure}

Cada cambio de sector eléctrico (cada \(60^\circ\) eléctricos) provoca la transición de exactamente uno de los canales Hall. Comparando el estado anterior y el actual del vector \((\mathrm{H1},\mathrm{H2},\mathrm{H3})\) se determina el sentido de giro. La relación entre ángulo eléctrico \(\theta_e\) y ángulo mecánico \(\theta_m\) es
\[
\theta_e = pp \cdot \theta_m,
\]
donde \(pp\) es el número de pares de polos. Así, la medición con Hall entrega una posición absoluta \emph{por sector} con resolución de \(60^\circ\) eléctricos. Para el motor estudiado (\(p=2\)), esto equivale a \(30^\circ\) mecánicos. En total hay \(6pp\) sectores por vuelta mecánica.

\begin{table}[H]
  \centering
  \caption{Estados Hall por sector (giro \textit{CW}, visto desde el extremo del eje).}
  \label{tab:hall_cw}
  \renewcommand{\arraystretch}{1.15}
  \begin{tabular}{cccc}
    \hline
    \textbf{Ángulo eléctrico} & \textbf{H1} & \textbf{H2} & \textbf{H3} \\
    \hline
    \(0^\circ \le \theta_e < 60^\circ\)   & 0 & 1 & 0 \\
    \(60^\circ \le \theta_e < 120^\circ\) & 0 & 1 & 1 \\
    \(120^\circ \le \theta_e < 180^\circ\)& 0 & 0 & 1 \\
    \(180^\circ \le \theta_e < 240^\circ\)& 1 & 0 & 1 \\
    \(240^\circ \le \theta_e < 300^\circ\)& 1 & 0 & 0 \\
    \(300^\circ \le \theta_e < 360^\circ\)& 1 & 1 & 0 \\
    \hline
  \end{tabular}
\end{table}

La secuencia anterior es la típica para \textit{CW} \((010 \rightarrow 011 \rightarrow 001 \rightarrow 101 \rightarrow 100 \rightarrow 110)\). Si se invierte el cableado de fases o la referencia de observación, la secuencia se recorre en orden inverso para \textit{CCW}.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Sensor de posición: \textit{encoder} incremental}
Al eje del motor se acopla un \textit{encoder} incremental modelo ENC-A2I del fabricante Anaheim Automation. Este dispositivo entrega realimentación digital para control de movimiento en posición, velocidad y dirección. Emplea dos canales ópticos en cuadratura que generan señales lógicas A y B desfasadas 90° eléctricos entre sí (véase \autoref{fig:encoder_led} y \autoref{fig:encoder_senales}).

\bigskip
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/encoder_led1.png}
    %\caption{}
  \end{subfigure}\hfill
  \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/encoder_led2.png}
    %\caption{}
  \end{subfigure}
  \caption{Esquema óptico de un \textit{encoder} incremental en cuadratura \cite{fiveflute_quadrature_encoders}.}
  \label{fig:encoder_led}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.6\linewidth]{figuras_equipos/encoder_senales.png}
  \caption{Señales de salida A, B e índice \(Z\) del \textit{encoder}.}
  \label{fig:encoder_senales}
\end{figure}

 El desfase permite determinar tanto el incremento de posición como el sentido de giro al comparar el estado anterior con el estado actual de \((A,B)\). Los pulsos pueden decodificarse con una máquina de estados como la mostrada en la \autoref{fig:encoder_estados}, donde el sentido del movimiento se infiere con la transición \((A,B)_{k-1}\to(A,B)_k\). Adicionalmente, dispone de un tercer canal de índice \(Z\) que produce un pulso una vez por vuelta, útil para referenciar el ángulo cero mecánico. 

\begin{figure}[H]
  \centering
  \includegraphics[width=0.45\linewidth]{figuras_equipos/encoder_estados.png}
  \caption{Máquina de estados para decodificación de cuadratura.}
  \label{fig:encoder_estados}
\end{figure}

Los parámetros principales indicados la hoja de datos \cite{anaheim_ENC_A2I_datasheet} son los siguientes:

\begin{multicols}{2}
\begin{itemize}
  \item Cuentas por revolución (CPR): 1000.
  \item Frecuencia máx.: hasta 300.000 ciclos/s.
  \item Alimentación: 5 V nominal (rango 4.5–5.5 V).
  \item Consumo típico: 55 mA.
  \item Canales: A y B en cuadratura; canal de índice \(Z\) 1× por vuelta.
  \item Salidas lógicas tipo TTL, \emph{single-ended}:
    \begin{itemize}
      \item Nivel bajo: \(V_{\mathrm{OL}} \le 0.5\) V.
      \item Nivel alto: \(V_{\mathrm{OH}} \ge 2.0\) V.
    \end{itemize}
\end{itemize}
\end{multicols}

Como terminales, el dispositivo cuenta con cinco conexiones: alimentación (5V y GND) y tres señales de posición (A, B y I). La \autoref{fig:encoder} muestra el equipo.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.3\linewidth]{figuras_equipos/encoder.jpeg}
  \caption{Encoder incremental utilizado para el \textit{setup}.}
  \label{fig:encoder}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Inversor trifásico}
El \texttt{BOOSTXL-3PhGaNInv} es un inversor trifásico con medición de corriente de fase basada en resistencias shunt. De acuerdo con la hoja de datos, presenta las siguientes características generales:

\begin{itemize}
  \item Acepta un rango amplio de voltaje de entrada en corriente continua desde 12V hasta 60V, con un valor nominal de operación de 48V.
  \item Etapa de conversión auxiliar que utiliza el convertidor \texttt{LM5017} para generar una línea de 5V. Esta línea alimenta al módulo de compuerta \texttt{LMG5200} y sirve como referencia para la generación de 3.3V utilizados para la comunicación GPIO.
  \item Tres fases del inversor implementadas como medio puente con un módulo GaN integrado \texttt{LMG5200}, especificado para 80V y 10A. 
  \item Sensado de corriente por fase mediante una resistencias shunt de 5 m\ohm{}. La señal se amplifica con un amplificador diferencial \texttt{INA240} configurado con una ganancia de 20V/V y un \textit{offset} de 1.65V.
  \item Interruptor de temperatura \texttt{TMP302} que supervisa la temperatura de la PCB en las cercanías del módulo de potencia GaN.
  \item Protección de sobrecorriente por hardware mediante \texttt{TLV3201}, ajustado a 12A con una histéresis de 1A.
  \item El motor se conecta a un borne trifásico dedicado que proporciona las tres salidas de fase del inversor.
\end{itemize}

La tarjeta ofrece un conector de interfaz pensado para un procesador huésped. A través de este conector se gestionan señales de mando y se disponen señales de medida condicionadas por la propia placa:

\begin{itemize}
  \item Entradas PWM para los transistores de lados alto y bajo para cada una de las tres fases.
  \item Señal de habilitación de PWM (tipo \textit{active low}) que permite habilitar o deshabilitar el inversor completo.
  \item Señal acondicionada de sensado de corriente de cada fase.
  \item Señal de voltajes de fase acondicionados y filtrados mediante un filtro de pasa bajos.
  \item Señal acondicionada de voltaje del enlace DC.
  \item Señal de alerta de sobretemperatura (\textit{active low}).
\end{itemize}

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/inversor_GaN.png}
    \caption{Diagrama de bloques del BOOSTXL-3PhGaNInv.}
    \label{fig:inversor_TI}
\end{figure}

El inversor, a nivel de componentes de electrónica de potencia, puede entenderse como un simple inversor trifásico de doble nivel, compuesto por 3 medios puentes, gatillados por seis señales de conmutación, como se muestra en la \autoref{fig:inversor_rashid}. Este se alimenta en base a una entrada DC, filtrada por medio de un capacitor de gran capacitancia a fin de obtener estabilidad en el nivel de tensión. Se clasifica en la categoría de VSI, dado que la conmutación de los semiconductores permite imponer niveles discretos de voltaje en las fases, mientras que la corriente de fase la impone la dinámica de la máquina.

\bigskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.65\linewidth]{figuras_equipos/inversor_rashid.png}
	\caption{Esquema simplificado de semiconductores del inversor \cite{rashid_book}.}
	\label{fig:inversor_rashid}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Microcontrolador}
Para implementar el sistema de control automático se utiliza la tarjeta \texttt{C2000\texttrademark\ LAUNCHXL-F28379D LaunchPad} de Texas Instruments. Mostrada en la \autoref{fig:delfino_descripcion_tarjeta}, actúa como plataforma de interfaz entre el microcontrolador \texttt{TMS320F28379D} y el resto del \textit{hardware} del accionamiento, facilitando la programación, depuración y evaluación directa desde el PC, así como la adquisición de señales de medida y el envío de señales de control.

Algunas de las principales características de la tarjeta son:

\begin{itemize}
  \item Interfaz USB para depuración y programación mediante sonda XDS100v2 aislada del resto de la tarjeta, con enlace USB/UART hacia el host.
  \item Dos LED de usuario y pulsador de \emph{reset} del dispositivo.
  \item Pines del dispositivo fácilmente accesibles para pruebas.
  \item Dos interfaces de \textit{quadrature encoder} de 5V (\(eQEP\)) expuestas en la placa.
\end{itemize}

Los distintos GPIO presentes en el pin-header se muestran en la \autoref{fig:delfino_pin_map}, con su respectivas conexiones a los periféricos del microcontrolador.

El \texttt{TMS320F28379D} integra dos CPU C28x en punto flotante a 200 MHz cada una (arquitectura de doble núcleo) y dos coprocesadores Control Law Accelerator (CLA) también a 200 MHz, lo que permite paralelizar lazos críticos y tareas auxiliares. Incorpora 1 MB de memoria flash y 204 kB de RAM, además de aceleradores de cálculo: VCU (Viterbi, aritmética compleja y CRC) y la unidad trigonométrica TMU.

Para la interfaz con el accionamiento, el dispositivo ofrece:
\begin{itemize}
	\item PWM de alta resolución: hasta 16 salidas HRPWM con control de flanco de 150 ps.
	\item Convertidores analógico–digitales: cuatro ADC con resolución seleccionable de 16 o 12 bits.
	\item Comparadores: 8 comparadores con ventana y referencias DAC internas de 12 bits.
	\item Comunicaciones serie: SCI, SPI e I\textsuperscript{2}C.
	\item Otras interfaces: CAN, McBSP y USB.
\end{itemize}

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/delfino_descripcion_tarjeta.png}
    \caption{Overview de la tarjeta LAUNCHXL-F28379D \cite{ti_SPRUI77C_launchxl_overview}.}
    \label{fig:delfino_descripcion_tarjeta}
\end{figure}

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{figuras_equipos/delfino_pin_map.png}
    \caption{Pin map de la tarjeta de desarrollo \cite{ti_launchxl_f28379d_pinmap}.}
    \label{fig:delfino_pin_map}
\end{figure}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Conexión
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{PLECS Coder y Target Support Package}
La implementación y configuración de los lazos de control del motor se realiza por medio del software PLECS, de \href{https://www.plexim.com/home}{Plexim}. Este incorpora una sencilla interfaz gráfica para simular circuitos eléctricos y los respectivos controladores, en conjunto con un potente motor de cálculo optimizado para resolución de simulaciones de sistemas de potencia.

La presente sección tiene como objetivo explicar el proceso de instalación de los componentes de software mínimos, además de introducir el uso de estos para los fines requeridos en el proyecto. Notar que los manuales necesarios se pueden descargar gratuitamente en la plataforma web de \href{https://www.plexim.com/download/documentation}{Plexim}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Instalación PLECS Coder}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Instalación C2000 Target Support Package}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Configuración de Coder}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Control
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Esquema de control conceptual}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Teoría básica del motor síncrono}
Consideremos un motor síncrono de imanes permanentes (PMSM), como en la \autoref{fig:configuracion_motor}. El estator de la máquina síncrona está conformado por tres enrrollados de fase distribuidos cuasi sinusoidalmente en la periferia del estator y desplazados espacialmente \(120^\circ\) eléctricos. La distribución idealmente sinusoidal no puede alcanzarse de forma exacta debido al número finito de ranuras, pero se diseña para aproximarla. Cada fase se conecta en serie con \(N_s\) espiras y sus conductores se alojan en ranuras del circuito magnético del estator, enfrentando el entrehierro (ver \autoref{fig:maquina_sincrona_flujos_stator}).

\medskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{figuras_teoria/maquina_sincrona_flujos_stator.png}
    \caption{Campo magnético generado por cada una de las fases del estator \cite{Vukosavic2013}.}
    \label{fig:maquina_sincrona_flujos_stator}
\end{figure}

Cada fase genera una fuerza magnetomotriz (FMM) determinada por el número de vueltas de la fase y por la corriente de fase. Cuando circulan corrientes alternas equilibradas de igual amplitud \(I_m\), frecuencia eléctrica \(\omega_e\) y desfasadas \(120^\circ\), cada fase produce una FMM sinusoidal sobre su eje magnético. Para un sistema de dos polos (extensible a \(p\) pares de polos ajustando la distribución de bobinas del estator), las FMM de fase se modelan como

\begin{equation}
\label{eqn:mmf_fases}
    \begin{aligned}
    F_a(t) &= N_s I_m \cos(\omega_e t) \\
    F_b(t) &= N_s I_m \cos\!\left(\omega_e t - \frac{2\pi}{3}\right) \\
    F_c(t) &= N_s I_m \cos\!\left(\omega_e t + \frac{2\pi}{3}\right)
    \end{aligned}
\end{equation}

\begin{comment}
Las FMM de fase \(F_a,F_b,F_c\) son magnitudes escalares definidas sobre los ejes de fase. Para describir el campo magnetizante neto en el entrehierro se utiliza el fasor espacial (o vector espacial) de la FMM, un vector en el plano del estator. Primero se obtienen las componentes en el marco estacionario \(\alpha\beta\):

\begin{equation}
    \label{eqn:clarke_F}
    \begin{bmatrix}
    F_\alpha \\[2pt] F_\beta
    \end{bmatrix}
    =
    \frac{2}{3}
    \begin{bmatrix}
    1 & -\tfrac{1}{2} & -\tfrac{1}{2}\\[2pt]
    0 & \tfrac{\sqrt{3}}{2} & -\tfrac{\sqrt{3}}{2}
    \end{bmatrix}
    \begin{bmatrix}
    F_a \\[2pt] F_b \\[2pt] F_c
    \end{bmatrix}
\end{equation}

El fasor espacial de la FMM se define como

\begin{equation}
\label{eqn:fasor_F}
    \underline{F}_S(t) \triangleq F_\alpha(t) + j\,F_\beta(t)
\end{equation}

equivalente a la forma compleja clásica

\begin{equation}
\label{eqn:fasor_F_alt}
    \underline{F}_S(t) = \frac{2}{3}\Big(F_a(t) + a\,F_b(t) + a^2\,F_c(t)\Big)
    \qquad a = e^{j\frac{2\pi}{3}}
\end{equation}

Para corrientes equilibradas, el módulo de \(\underline{F}_S\) es prácticamente constante y su argumento crece a velocidad \(\omega_e\):

\begin{equation}
\label{eqn:fasor_equilibrado}
    \big|\underline{F}_S\big| = \frac{3}{2}\,N_s I_m,
    \qquad
    \underline{F}_S(t) = \frac{3}{2}\,N_s I_m\,e^{j\omega_e t}.
\end{equation}

En el plano físico, el vector resultante de FMM del estator es

\begin{equation}
\label{eqn:F_vector}
    \vec{F}_S(t) = F_\alpha(t)\,\hat{\alpha} + F_\beta(t)\,\hat{\beta},
\end{equation}

y también puede interpretarse como la suma vectorial de las contribuciones de fase

\begin{equation}
\label{eqn:F_suma}
    \vec{F}_S(t) = \vec{F}_a(t) + \vec{F}_b(t) + \vec{F}_c(t),
\end{equation}

cuyo módulo permanece prácticamente constante y cuyo eje gira en el espacio a velocidad eléctrica \(\omega_e\). La orientación de \(\vec{F}_S\) respecto de los ejes de fase puede verse en la \autoref{fig:maquina_sincrona_flujos_stator}.
\end{comment}

Las tres FMM de fase \(F_a,F_b,F_c\) se combinan en un fasor espacial \(\underline{F}_S\) que representa el campo magnetizante neto en el entrehierro. Intuitivamente, las contribuciones de fase se suman vectorialmente y el resultado es un vector giratorio de módulo casi constante que rota a velocidad eléctrica \(\omega_e\).

Para esto, se define directamente el fasor espacial como

\begin{equation}
	\label{eq:Fs_directo}
	\underline{F}_S(t) \;=\; \frac{2}{3}\,\big[F_a(t) + a\,F_b(t) + a^{2}F_c(t)\big]
	\qquad \qquad \qquad \qquad
	a \,=\, e^{j\frac{2\pi}{3}}
\end{equation}

asumiendo sistema balanceado y ausencia de secuencia cero. Para corrientes equilibradas de amplitud \(I_m\) en \(N_s\) espiras, el módulo y la evolución temporal del fasor son

\begin{equation}
	\label{eq:Fs_modulo_fase}
	\big|\underline{F}_S\big| \,=\, \tfrac{3}{2}\,N_s I_m
	\qquad \qquad \qquad \qquad \qquad
	\underline{F}_S(t) \,=\, \tfrac{3}{2}\,N_s I_m\,e^{j\omega_e t}
\end{equation}

lo que muestra explícitamente que el campo resultante mantiene módulo casi constante y su argumento crece a \(\omega_e\). Este resultado corresponde al principio del teorema de Ferraris: la superposición de tres FMM sinusoidales equilibradas y desfasadas \(120^\circ\) genera un campo giratorio que rota a \(\omega_e\) \cite{FraileMora}. En el plano físico, la orientación instantánea de \(\underline{F}_S\) puede visualizarse como el eje del campo magnetizante del estator (ver \autoref{fig:maquina_sincrona_flujos_stator}).

El flujo magnético estatórico se obtiene dividiendo la FMM resultante por la reluctancia magnética efectiva \(R_\mu\). Denotando por \(\vec{\Psi}_S\) al vector de enlace de flujo por vuelta del estator, se tiene

\begin{equation}
\label{eqn:psi_s}
    \vec{\Psi}_S(t) = \frac{N_s\,\vec{F}_S(t)}{R_\mu}
\end{equation}

En una máquina real, \(R_\mu\) representa la reluctancia equivalente del camino magnético hierro–entrehierro–hierro, que integra el efecto de dientes y yugo del estator, el entrehierro y las partes activas del rotor. En la práctica, el entrehierro (con \(\mu=\mu_0\)) suele dominar el valor de \(R_\mu\), mientras que ranurado, excentricidades y saturación introducen una débil dependencia con la posición. Por convenio, \(R_\mu\) se asocia al camino mutuo que acopla estator y rotor, mientras que los trayectos que no cruzan el entrehierro se modelan por separado como fugas.

Bajo esta interpretación, el flujo del estator se descompone en dos contribuciones: una componente de dispersión, que no cruza el entrehierro ni enlaza el rotor, y una componente mutua o de entrehierro, que sí lo hace y participa del acoplamiento. La suma de ambas determina el flujo total que aparece en el entrehierro.

En el rotor, los imanes permanentes generan un vector de flujo \(\vec{\Psi}_R\) fijo al rotor (ver \autoref{fig:maquina_sincrona_flujos}). El ángulo eléctrico entre \(\vec{\Psi}_S\) y \(\vec{\Psi}_R\) se denota por \(\delta\). El par electromagnético se origina por la interacción entre el flujo del rotor y la FMM/flujo del estator. En forma compacta:

\begin{equation}
\label{eqn:torque_vectorial}
    \vec{T}_{em} = k_t\, \vec{\Psi}_R \times \vec{F}_S
    \;\;\Longrightarrow\;\;
    T_{em} \propto |\vec{\Psi}_R|\,|\vec{\Psi}_S|\,\sin\delta,
\end{equation}

donde \(k_t\) es una constante constructiva. En régimen permanente, para que el par y la potencia sean constantes, la posición relativa entre \(\vec{\Psi}_S\) y \(\vec{\Psi}_R\) debe permanecer fija, lo que exige que el rotor gire en sincronismo con el campo del estator (\(\omega_m = \Omega_s\)). Este comportamiento puede visualizarse en la \autoref{fig:maquina_sincrona_flujos}, donde el vector \(\vec{F}_S\) gira a la misma velocidad que el rotor. Con lo anterior, la corriente y voltaje en el estator también deben ser sinusoidales con velocidad angular síncrona al rotor (\(\omega_e\)).

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\linewidth]{figuras_teoria/maquina_sincrona_flujos.png}
    \caption{Flujos magnéticos presentes en la máquina síncrona \cite{Vukosavic2013}.}
    \label{fig:maquina_sincrona_flujos}
\end{figure}

La posición eléctrica y la relación entre variables mecánicas y eléctricas son:

\begin{equation}
\label{eqn:ang_elec}
    \theta_e = pp \cdot \theta_m
    \qquad \qquad \qquad
    \omega_e = \dot{\theta}_e = pp \cdot \omega_m
\end{equation}

donde \(pp\) es el número de pares de polos, \(\theta_m\) es el ángulo mecánico y \(\omega_m\) la velocidad mecánica. En consecuencia, la velocidad mecánica sincrónica es

\begin{equation}
\label{eqn:omega_sync}
    \Omega_s \;=\; \frac{\omega_e}{pp}
\end{equation}

Finalmente, nótese que para producir un \(\vec{F}_S\) de módulo casi constante que gire a \(\omega_e\) es imprescindible aplicar voltajes trifásicos sinusoidales, equilibrados y desfasados \(120^\circ\) en las bobinas del estator, lo que asegura corrientes igualmente sinusoidales y, por tanto, un campo giratorio uniforme en el entrehierro.

Por otra parte, el acoplamiento entre rotor y estator se describe con el balance de voltaje en los arrollamientos estatóricos (ver \autoref{fig:equivalente_abc}):

\begin{equation}
\label{eqn:abc_voltage}
\begin{bmatrix} v_a \\ v_b \\ v_c \end{bmatrix}
=
\begin{bmatrix} R_a & 0 & 0 \\ 0 & R_b & 0 \\ 0 & 0 & R_c \end{bmatrix}
\begin{bmatrix} i_a \\ i_b \\ i_c \end{bmatrix}
\;+\;
\frac{d}{dt}
\begin{bmatrix} \psi_a \\ \psi_b \\ \psi_c \end{bmatrix}.
\end{equation}

Los enlaces de flujo por fase se expresan como

\begin{equation}
\label{eqn:abc_flux}
    \begin{bmatrix} \psi_a \\ \psi_b \\ \psi_c \end{bmatrix}
    \; = \;
    \underbrace{\begin{bmatrix}
    L_{aa}(\theta_e) & M_{ab}(\theta_e) & M_{ac}(\theta_e)\\
    M_{ab}(\theta_e) & L_{bb}(\theta_e) & M_{bc}(\theta_e)\\
    M_{ac}(\theta_e) & M_{bc}(\theta_e) & L_{cc}(\theta_e)
    \end{bmatrix}}_{\mathbf{L}(\theta_e)}
    \begin{bmatrix} i_a \\ i_b \\ i_c \end{bmatrix}
    \;+\;
    \begin{bmatrix} \psi_{ma}(\theta_e) \\ \psi_{mb}(\theta_e) \\ \psi_{mc}(\theta_e) \end{bmatrix}
\end{equation}

donde \(L_{aa}\), \(L_{bb}\) y \(L_{cc}\) son las autoinductancias de las fases \(a\), \(b\) y \(c\), \(M_{ab}\), \(M_{ac}\), \(M_{bc}\) son las inductancias mutuas entre fases, y \(\psi_{ma}\), \(\psi_{mb}\), \(\psi_{mc}\) son los enlaces de flujo vistos por las fases debidos a los imanes permanentes. En máquinas simétricas suele cumplirse \(R_a=R_b=R_c\triangleq R_s\), \(L_{aa}=L_{bb}=L_{cc}\) y \(M_{ab}=M_{bc}=M_{ca}\), con relaciones geométricas fijadas por el desplazamiento de \(120^\circ\).

\medskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.45\linewidth]{figuras_teoria/equivalente_abc.png}
    \caption{Circuito equivalente (transiente) de la máquina síncrona en referencia \textit{abc} \cite{Manias2017}.}
    \label{fig:equivalente_abc}
\end{figure}

Debido a la saturación magnética y a la construcción mecánica de la máquina síncrona de imanes permanentes, tanto las autoinductancias como las mutuas son funciones del ángulo eléctrico del rotor \(\theta_e\) (igual al ángulo síncrono). Este ángulo coincide prácticamente con la dirección del flujo del rotor (polo norte de los imanes), mientras que para \(\theta_e=0\) el eje del flujo del rotor se alinea con la fase \(a\). Por la misma razón, los enlaces de flujo de los imanes \(\psi_{m\{a,b,c\}}(\theta_e)\) dependen de \(\theta_e\).

De forma compacta, \eqref{eqn:abc_voltage}–\eqref{eqn:abc_flux} pueden escribirse como

\begin{equation}
\label{eqn:voltaje_corriente_compacto}
    \underline{v} \;=\; \mathbf{R}\,\underline{i} \;+\; \frac{d\,\underline{\psi}}{dt}
    \qquad \qquad \qquad \qquad
    \underline{\psi} \;=\; \mathbf{L}(\theta_e)\,\underline{i} \;+\; \underline{\psi_m}(\theta_e)
\end{equation}

con \(\underline{(\cdot)}\) denotando vectores de fase en \(abc\).

Adicionalmente, de las ecuaciones (\ref{eqn:abc_voltage}) y (\ref{eqn:abc_flux}) se puede obtener una relación para el torque electromagnético:

\begin{equation}
    T_{em} \; = \; pp \cdot \bigg( \underline{i}^T \; \dfrac{d \underline{\psi_m}}{dt}(\theta_e) \, + \, \frac{1}{2} \, \underline{i}^T \dfrac{d \mathbf{L}}{d\theta_e}(\theta_e) \, \underline{i}\bigg)
\label{eqn:torque_general}
\end{equation}

De la ecuación (\ref{eqn:abc_voltage}) se puede concluir que para una ubicación fija del rotor ($\theta_e$), el valor instantáneo de la corriente estatórica $\underline{i}$ depende netamente del voltaje instantáneo ($\underline{v}$) impuesto en las bobinas. Mientras que de la ecuación (\ref{eqn:torque_general}), se obtiene que el torque instantáneo generado por el rotor depende de la corriente estatórica. Por lo tanto, se puede concluir que el torque generado por la máquina puede ser manipulado mediante un control preciso del voltaje en cada una de las fases.

Por otra parte, en lo que respecta a la dinámica de un motor sometido a un torque de carga $T_L$, esta queda controlada según la ecuación:

\begin{equation}
    T_{em} - T_L \; = \; J_m \cdot \dot{w}_m
\label{eqn:torque_equilibrio}
\end{equation}

donde $J_m$ corresponde a la inercia rotacional del rotor de la máquina. Es decir, que el motor tendrá una aceleración positiva e incrementará su velocidad en la medida que el torque generado en base a la ecuación (\ref{eqn:torque_general}) sea superior a la carga, y se frenará en el caso contrario.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Transformación del marco de referencia: Clarke y Park}

Las variables trifásicas de la máquina (voltajes, corrientes y flujos) pueden representarse mediante \textit{vectores espaciales complejos} \cite{TI_BPRA073_1998}. Para las corrientes, el vector espacial del estator se define como

\begin{equation}
	\label{eq:is_space_vector}
	\underline{i}_s \;=\; \frac{2}{3}\,\big(i_a \;+\; \alpha\,i_b \;+\; \alpha^{2}\,i_c\big)
	\qquad \qquad \qquad \qquad
	\alpha \;=\; e^{j\frac{2\pi}{3}}
\end{equation}

donde \(\alpha\) y \(\alpha^2\) son los operadores espaciales que rotan \(120^\circ\) y \(240^\circ\) eléctricos, respectivamente. La construcción geométrica de \(\underline{i}_s\) se ilustra en la \autoref{fig:space_vector_corriente}.

Para analizar y controlar la máquina se emplea usualmente una transformación en dos etapas (ver \autoref{fig:clarke_park_concepto}): primero se proyecta el sistema trifásico a un marco estacionario bi-axial \(\alpha\beta\), luego se rota ese marco a un sistema \(dq\) que gira a una cierta velocidad \(\omega\), según se muestra en la \autoref{fig:clarke_park_concepto}. 

\medskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.32\linewidth]{figuras_teoria/space_vector_formulacion.png}
	\caption{Vector espacial complejo de corriente del estator \(\underline{i}_s\) a partir de \(i_a,i_b,i_c\) \cite{TI_BPRA073_1998}.}
	\label{fig:space_vector_corriente}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.65\linewidth]{figuras_teoria/abc_dq_concepto.png}
	\caption{Esquema conceptual: \(abc\) estacionario \(\rightarrow\) \(\alpha\beta\) estacionario (Clarke) \(\rightarrow\) \(dq\) girante (Park) \cite{HughesDrury2019}.}
	\label{fig:clarke_park_concepto}
\end{figure}

\paragraph{Clarke} Como se menciona anteriormente, la Transformada de Clarke, también conocida como Transformada alfa-beta, permite representar cual conjunto trifásico balanceado \(abc\) de valores, en un par de valores en ejes ortogonales \(\alpha - \beta\). En general

\begin{equation}
	\label{eq:clarke_matrix}
	\begin{bmatrix}
		i_\alpha \\[2pt] i_\beta \\[2pt] i_0
	\end{bmatrix}
	=
	K \;
	\begin{bmatrix}
		1 & -\tfrac{1}{2} & -\tfrac{1}{2}\\[2pt]
		0 & \tfrac{\sqrt{3}}{2} & -\tfrac{\sqrt{3}}{2}\\[2pt]
		\tfrac{1}{2} & \tfrac{1}{2} & \tfrac{1}{2}
	\end{bmatrix}
	\begin{bmatrix}
		i_a \\[2pt] i_b \\[2pt] i_c
	\end{bmatrix}
\end{equation}

Donde $K$ corresponde a una constante que se puede seleccionar en base al objetivo de la transformación. En su forma mas ampliamente utilizada, y la que se considera para el presente trabajo, se considera $K=2/3$. Este valor permite conservar la amplitud de las sinusoides al realizar la conversión. Adicionalmente, al considerar el sistema balanceado, se convierte en:

\begin{equation}
	\label{eq:clarke_matrix_simp}
	\begin{bmatrix}
		i_\alpha \\[2pt] i_\beta
	\end{bmatrix}
	=
	\dfrac{2}{3} \;
	\begin{bmatrix}
		1 & -\tfrac{1}{2} & -\tfrac{1}{2}\\[2pt]
		0 & \tfrac{\sqrt{3}}{2} & -\tfrac{\sqrt{3}}{2}
	\end{bmatrix}
	\begin{bmatrix}
		i_a \\[2pt] i_b \\[2pt] i_c
	\end{bmatrix}
\end{equation}

\paragraph{Park} La Transformada de Park, tambien conocida como \(dq\), permite proyectar un marco de referencia ortogonal (como el alfa-beta) sobre una referencia también ortogonal, cuyos ejes se conocen como $d$ y $q$ en referencia a la denominación de eje "directo" y eje de "cuadratura", en un ángulo \(\theta\) cualquiera, rotando a una cierta velocidad angular \(\omega\).

\begin{equation}
	\label{eq:park_matrix}
	\begin{bmatrix}
		i_d \\[2pt] i_q
	\end{bmatrix}
	=
	\begin{bmatrix}
		\cos\theta & \sin\theta\\[2pt]
		-\sin\theta & \cos\theta
	\end{bmatrix}
	\begin{bmatrix}
		i_\alpha \\[2pt] i_\beta
	\end{bmatrix}
\end{equation}

\paragraph{Clarke-Park} Ambas transformaciones se pueden unificar en una única matriz de transformación:

\begin{equation}
	\label{eq:clarke_park_directa_dq}
	\begin{bmatrix}
		i_d\\[2pt]
		i_q
	\end{bmatrix}
	=
	\frac{2}{3}
	\begin{bmatrix}
		\cos\theta & \cos\!\left(\theta-\tfrac{2\pi}{3}\right) & \cos\!\left(\theta+\tfrac{2\pi}{3}\right)\\[6pt]
		-\sin\theta & -\sin\!\left(\theta-\tfrac{2\pi}{3}\right) & -\sin\!\left(\theta+\tfrac{2\pi}{3}\right)
	\end{bmatrix}
	\begin{bmatrix}
		i_a\\[2pt] i_b\\[2pt] i_c
	\end{bmatrix}
\end{equation}


La transformación inversa ($abc \longrightarrow dq$)se obtiene invirtiendo las matriz anterior.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Modelo dinámico $d-q$}
\label{sec:modelo_dinamico_dq}

En la ecuación dinámica (\ref{eqn:voltaje_corriente_compacto}), puede notarse que el flujo de enlace \(\psi\) depende de la posición angular \(\theta_e\) del rotor, de tal forma que para cada posición se induce un voltaje distinto en las bobinas del estator. Sin embargo, esta ecuación se puede simplificar al considerar un marco de referencia bi-axial y rotatorio, en el cual el eje directo \(d\) se encuentra alineado con el vector de flujo magnético generado por el rotor \(\psi_m\), con ángulo $\theta_e$, mientras el eje de cuadratura está a 90° eléctricos (equivalente a 90° mecánicos en el caso de un motor de un par de polos). Este marco estará rotando a velocidad síncrona \(\omega_e\).	

\bigskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\linewidth]{figuras_teoria/pmsm_ab_dq_esquema_motor.png}
	\caption{Transformación a referencia rotacional de las corrientes estatóricas \cite{Quang_dittrich}.}
	\label{fig:pmsm_ab_dq_esquema_motor}
\end{figure}

En este caso, se puede demostrar que la ecuación (\ref{eqn:voltaje_corriente_compacto}) se convierte en:

\begin{equation}
	\label{eqn:dq_voltage}
	\begin{bmatrix} v_d \\ v_q \end{bmatrix}
	=
	\begin{bmatrix} R_d & 0 \\ 0 & R_q \end{bmatrix}
	\begin{bmatrix} i_d \\ i_q \end{bmatrix}
	\;+\;
	\frac{d}{dt}
	\begin{bmatrix} \psi_d \\ \psi_q \end{bmatrix}.
\end{equation}

Los enlaces de flujo por fase se expresan como

\begin{equation}
	\label{eqn:dq_flux}
	\begin{bmatrix} \psi_d \\ \psi_q \end{bmatrix}
	\; = \;
	\begin{bmatrix}
		L_d & 0\\
		0 & L_q
	\end{bmatrix}
	\begin{bmatrix} i_d \\ i_q \end{bmatrix}
	\;+\;
	\begin{bmatrix} \psi_{m} \\ 0 \end{bmatrix}
\end{equation}

Lo cual resulta en:

\begin{equation}
	\begin{bmatrix}
		v_d \\ v_q
	\end{bmatrix}
	\; = \;
	R_s
	\begin{bmatrix}
		i_d \\ i_q
	\end{bmatrix}
	\, + \, 
	\begin{bmatrix}
		L_d & 0 \\
		0 & L_q
	\end{bmatrix}
	\dfrac{d}{dt}
	\begin{bmatrix}
		i_d \\ i_q
	\end{bmatrix}	
	\, + \, 
	\omega_e \,
	\bigg(
	\begin{bmatrix}
		L_d & 0\\
		0 & L_q
	\end{bmatrix}
	\begin{bmatrix}
		-i_q \\ i_d
	\end{bmatrix}
	\, + \,
	\begin{bmatrix}
		0 \\ \psi_m
	\end{bmatrix}		
	\bigg)	
\end{equation}

Adicionalmente, puede demostrarse que el torque electromagnético puede obtenerse a partir de las cantidades en el marco \(d-q\) según la expresión:

\begin{equation}
	T_{em} \; = \;
	\dfrac{3}{2} \cdot pp \cdot \big[\psi_m \, i_q + (L_d - L_q) \, i_d \, i_q\big]
\end{equation}

La \autoref{fig:spmsm_ipmsm_dq} muestra la conversión de referencias tanto para motores de rotor cilíndrico como en el caso de rotor asimétrico. 

En base a la discusión previamente abarcada en la \autoref{sec:intro_control}, la condición de torque neto en estado estacionario implica voltajes y corrientes con frecuencia idéntica a la frecuencia del campo magnético rotórico (\(\omega_e\)). Por lo tanto, en estado estacionario tanto voltajes como corrientes en marco $d-q$ serán constantes. Es decir que las señales sinusoidales equilibradas en \(abc\) pasan a ser casi constantes en \(dq\) en régimen estacionario.

\smallskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.55\linewidth]{figuras_teoria/spmsm_ipmsm_dq.png}
	\caption{Resultado para máquina de rotor cilíndrico (izquierda) y rotor con polos salientes \cite{Ghassani2023_RFOC_SFOC}.}
	\label{fig:spmsm_ipmsm_dq}
\end{figure}

El foco del presente trabajo está puesto en el caso específico del motor isotrópico, tal que la inductancia estatórica de ambos ejes es idéntica $L_d = L_q = L_s$. Con lo cual las ecuaciones de tensión y torque resultan:

\begin{equation}
	\label{eqn:voltaje_dq}
	\begin{bmatrix}
		v_d \\ v_q
	\end{bmatrix}
	\; = \;
	R_s
	\begin{bmatrix}
		i_d \\ i_q
	\end{bmatrix}
	\, + \, 
	L_s
	\dfrac{d}{dt}
	\begin{bmatrix}
		i_d \\ i_q
	\end{bmatrix}	
	\, + \, 
	\omega_e \,
	\bigg(
	L_s
	\begin{bmatrix}
		-i_q \\ i_d
	\end{bmatrix}
	\, + \,
	\begin{bmatrix}
		0 \\ \psi_m
	\end{bmatrix}		
	\bigg)	
\end{equation}

\begin{equation}
	\label{eqn:torque_dq}
	T_{em} \; = \;
	\dfrac{3}{2} \cdot pp \cdot \psi_m \, i_q
\end{equation}

Es decir, para el PMSM el torque generado por la máquina puede ser controlado mediante un sencillo control de magnitud de la corriente de cuadratura (\(i_q\)), al ser directamente proporcional a esta. Además, puede notarse que si bien un incremento en el voltaje de cada eje genera un incremento en la corriente respectiva, la relación entre ambos ejes se encuentra acoplada mediante el último término, donde se nota que las corrientes impactan de forma cruzada al eje contrario.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Introducción al control de máquinas síncronas}
\label{sec:intro_control}

En base al análisis presentado previamente, se justifica un esquema de control de velocidad basado en el voltaje como variable manipulada en la medida de que cuenta con mediciones de velocidad angular como variable controlada. Es específico, se considera un lazo como el mostrado en la \autoref{fig:bloques_clases}, en el cual el bloque de control utiliza mediciones de corriente del motor, así como la velocidad del eje mecánico, a fin de manipular el voltaje entregado a la máquina.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_teoria/bloques_clases.png}
    \caption{Esquema básico del control de velocidad de un motor \cite{accionamientos_lesson3}.}
    \label{fig:bloques_clases}
\end{figure}

De forma más general, se suelen incluir distintos tipos de controladores en cascada con la finalidad de controlar tanto el torque generado por el motor, o bien la velocidad de operación, inclusive el ángulo mecánico del eje. Esto se muestra en la \autoref{fig:control_general_cascadas}.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{figuras_teoria/control_general_cascadas.png}
    \caption{Esquema generalizado de control de un motor síncrono en base a controladores en cascada \cite{accionamientos_lesson3}.}
    \label{fig:control_general_cascadas}
\end{figure}

Notar que, si bien los lazos de control pueden implementarse con distintos reguladores, en la práctica los VFD utilizan controladores PI debido a su sencillez, robustez y facilidad de sintonía, además de estar ampliamente validados por la experiencia práctica y ofrecer lazos usualmente estables y rápidos. Ahora bien, para que esos PI trabajen con referencias constantes y el par sea regulado con respuesta transitoria rápida, se recurre al control vectorial.

En términos generales, los métodos de control para PMSM se dividen en escalar y vectorial (ver \autoref{fig:tipos_control_pmsm_review}) \cite{rashid_book,Ghassani2023_RFOC_SFOC,FOC_EV}. El control escalar ajusta solo la amplitud y la frecuencia de los vectores espaciales de voltaje, corriente y flujo a partir de ecuaciones de régimen permanente, por lo que no actúa sobre la posición instantánea de dichos vectores durante transitorios. Al operar en estado estacionario aparece la ley clásica \(V/f\): si el motor se alimenta desde una fuente de voltaje y se mantiene aproximadamente constante la razón entre el voltaje fundamental y la frecuencia eléctrica (\(V/\omega_e \approx \mathrm{cte}\)), el flujo de entrehierro se mantiene casi constante y el torque máximo resulta prácticamente invariante en velocidad (antes de saturar la tensión disponible del bus DC y sin debilitamiento de campo).

\medskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{figuras_teoria/tipos_control_pmsm_review.png}
	\caption{Resumen simplificado de los tipos de controladores de máquinas síncronas \cite{Ghassani2023_RFOC_SFOC}.}
	\label{fig:tipos_control_pmsm_review}
\end{figure}

Despreciando la caída en \(R_s\) cerca o por sobre la frecuencia base, el par desarrollado puede obtenerse del diagrama fasorial como

\begin{equation}
\label{eq:T_V_by_omega}
    T \;\approx\; \frac{3}{\omega_e}\,\frac{E\,V}{X_s}\,\sin\delta
    \;=\; \frac{3}{\omega_e}\,\frac{E\,V}{\omega_e L_s}\,\sin\delta
\end{equation}

donde \(X_s=\omega_e L_s\), \(L_s\) es la inductancia síncrona (en SPMSM, \(L_d \approx L_q \triangleq L_s\)), \(V\) es el voltaje fundamental aplicado, \(E\) la f.e.m. inducida (con \(E=\omega_e K_e \Phi\)), y \(\delta\) el ángulo entre el vector de flujo del rotor y el vector de FMM/voltaje del estator. De la ecuación \eqref{eq:T_V_by_omega} se deduce que, manteniendo \(V/\omega_e \approx \mathrm{cte}\) y \(\delta\) casi constante, el par máximo permanece aproximadamente constante en un amplio rango de velocidades. Un ejemplo de este tipo de controlador se muestra en la \autoref{fig:pmsm_control_vf}. 

\medskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{figuras_teoria/pmsm_control_vf.png}
    \caption{Control de lazo abierto tipo V/f para un PMSM alimentado por un inversor tipo VSI \cite{Manias2017}.}
    \label{fig:pmsm_control_vf}
\end{figure}

Esta filosofía escalar limita la respuesta dinámica al no gobernar la orientación instantánea de los vectores espaciales. En cambio, el control vectorial ajusta la magnitud, la frecuencia y también los valores instantáneos (posición) de esos vectores espaciales, lo que habilita un desempeño dinámico superior y lo ha consolidado como la estrategia de alto rendimiento para PMSM.

Dentro de la familia vectorial, coexisten enfoques con distinta implementación. El Direct Torque Control (DTC) opera en coordenadas de vector espacial: utiliza dos comparadores de histéresis (bang–bang), uno sobre el módulo del flujo estatórico y otro sobre el torque electromagnético, y junto con la posición del vector de flujo selecciona en cada instante el vector de voltaje del inversor a partir de una tabla de conmutación. Esta acción directa proporciona una respuesta de torque muy rápida y una estructura simple, a costa de una frecuencia de conmutación variable y de un rizado superior de torque y flujo, aunque existen variantes que mitigan estas limitaciones \cite{Ghassani2023_RFOC_SFOC}.

\smallskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\linewidth]{figuras_teoria/DTC_esquema.png}
	\caption{Control tipo \textit{Direct Torque Control} \cite{HughesDrury2019}.}
	\label{fig:DTC_esquema}
\end{figure}

El control vectorial \textit{Field Oriented Control}, recibe su nombre por implementarse bajo el concepto de implementar los lazos de control dentro del espacio $d-q$, tal que la transformada Clarke-Park considere el eje directo ($\hat{d}$) alineado con alguno de los campos magnéticos generados. El estudio presentado anteriormente, considera una alineación con el fasor de flujo magnético rotórico ($\psi_m$), tal que el ángulo de la transformación se alínea con el eje mecánico de rotación ($\theta_e \, = \, pp \cdot \theta_m$), lo cual se conoce como \textit{R-FOC}. Esto es lo más común en la implementación de controladores para motores síncronos, dado que el ángulo de referencia ($\theta_e$) se puede obtener directamente de la medición de posición del eje de la máquina \cite{rashid_book,Manias2017,Ghassani2023_RFOC_SFOC,HughesDrury2019}.

Según se presenta en la \autoref{fig:tipos_control_pmsm_review}, existen implementaciones en que se considera una referencia alineada con el flujo generado por el bobinado de armadura, conocido como \textit{SFOC} \cite{Ghassani2023_RFOC_SFOC} \cite{KAZMIERKOWSKI2002161}. En máquinas de inducción (MI) esta clasificación se extiende aún más. En esta, el ángulo del fasor de flujo rotórico no corresponde con la posición del rotor, por lo cual se han desarrollado distintos tipos de herramientas para obtener dicho ángulo, derivando en \textit{RFOC} de tipo \textit{directo} (D-RFOC) y de tipo \textit{indirecto} (I-RFOC)\cite{KAZMIERKOWSKI2002161}. 

Un aspecto clave de este enfoque es que, al trabajar en el marco síncrono \(dq\), la transformación de Park convierte el conjunto de ecuaciones diferenciales de la máquina, que posee coeficientes dependientes del tiempo en un marco estacionario, en un sistema con coeficientes invariantes en el tiempo, es decir, un sistema LTI \cite{Manias2017}. En la práctica, esto significa que las variables de control \(i_d\) e \(i_q\) tienden a ser constantes en régimen permanente, lo que mejora notablemente el desempeño de controladores PI: se eliminan errores de seguimiento asociados a referencias sinusoidales y se simplifica la sintonía, al tratar cada eje como un lazo aproximadamente de primer orden tras el desacoplo.

En síntesis, el control vectorial regula no solo la magnitud y la frecuencia, sino también los valores instantáneos y la orientación de los vectores espaciales de voltaje, corriente y flujo, lo que habilita un desempeño dinámico superior tanto en régimen permanente como en transitorios \cite{Ghassani2023_RFOC_SFOC}. En particular, la orientación de campo permite obtener cambios (casi) instantáneos de torque, es decir, saltar directamente de un estado estacionario a otro, al imponer referencias de corriente adecuadas en el marco síncrono \cite{HughesDrury2019}. 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Field Oriented Control en PMSM}

En su implementación más tradicional, el control de velocidad por medio de RFOC toma la forma indicada en la \autoref{fig:rfoc_esquema_general}. Este sistema considera dos mediciones para su implementación, las corrientes estatóricas (\(i_{abc}\)) y la posición (\(\theta_m\)) del eje mecánico del motor.

En este esquema, se tienen tres bloques de control principales configurados en forma da ``cascada''. En primer lugar, se emplea un control proporcional-integral como regulador de velocidad, tal que en la medida de que la velocidad medida se inferior a la de referencia, se incrementa el torque de referencia generado para las etapas posteriores. Esto se justifica en base a la ecuación (\ref{eqn:torque_equilibrio}) de equlibrio de fuerzas, tal que en la medida que el motor genere un torque superior al de la carga, habrá una aceleración neta del motor.

\bigskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\linewidth]{figuras_teoria/rfoc_esquema_general.png}
	\caption{Esquema general de control RFOC de velocidad en un motor PMSM \cite{Ghassani2023_RFOC_SFOC}.}
	\label{fig:rfoc_esquema_general}
\end{figure}

El segundo bloque de control ``Reference Generator'', se encarga de generar las referencias de corriente en eje directo y cuadratura para la siguiente etapa de control, en base al torque de referencia recibido. Considerando la ecuación (\ref{eqn:torque_dq}), el torque generado por la máquina será proporcional a la corriente del eje en cuadratura (\(i_q\)). Adicionalmente, cualquier máquina utilizada presentará límites térmicos sobre la magnitud máxima de corriente que se utilice, por lo cual en la práctica se limita la magnitud total del fasor de corriente $d-q$ a la cantidad:

\begin{equation}
	\label{eqn:limite_idq_general}
	\sqrt{i_d^2 + i_q^2} \; \leq \; I_{nom} \sqrt{2}
\end{equation}

Con $I_{nom}$ la corriente nominal efectiva (RMS) de la máquina. Luego, dado el carácter limitado de la corriente, en general para la operación a velocidad baja-moderada, la práctica es considerar nula corriente en el eje directo (\(i_d^* = 0\)) y la totalidad de la corriente de cuadratura (\(i_q^*\)) necesaria para desarrollar el torque deseado, según:

\begin{equation}
	i_d^* \; = \; 0
	\qquad \qquad \qquad \qquad 
	i_q^* \; = \; \dfrac{T_{em}}{3/2 \cdot pp \cdot \psi_m}
\end{equation}

Esta implementación se conoce como \textit{Maximum Torque per Ampere} (MTPA), tal que configura para obtener el máximo torque posible bajo la limitación de corriente de la máquina. Adicionalmente, para operación a altas velocidades, el comportamiento anterior debe ser modificado, lo cual se conoce como \textit{Field Weakening}. Este comportamiento será analizado en una sección sub-siguiente.

El tercer bloque de control corresponde al regulador de corriente estatórica, el cual se muestra en la \autoref{fig:rfoc_esquema_corriente}. Para esto, se considera un \textit{feedback} de medición de las corrientes, el cual permite ajustar los voltajes del estator en base a un bloque de control proporcional-integrativo. Esto se basa en la ecuación (\ref{eqn:voltaje_dq}), de tal forma en que a medida que se incremente el voltaje en cada eje, se generará un incremento en la corriente respectiva. Dado el acoplamiento de ambos ejes descrito en la \autoref{sec:modelo_dinamico_dq}, se incluye en el control de cada eje la suma del término de acoplamiento. De esta forma, el control PI se encarga de ajustar netamente la corriente propia del eje controlado.

Finalmente, de la \autoref{fig:rfoc_esquema_general} puede notarse que entre los bloques de control de corriente y el inversor, se incluye el bloque ``PWM'', el cual se encarga de generar las señales de control para el inversor que alimenta la armadura de la máquina. Este bloque se estudia en la siguiente sección.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\linewidth]{figuras_teoria/rfoc_esquema_corriente.png}
	\caption{Esquema general de control RFOC de corriente de un motor PMSM \cite{Ghassani2023_RFOC_SFOC}.}
	\label{fig:rfoc_esquema_corriente}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Introducción a PWM y revisión breve}
\label{sec:pwm_review}

Completando el esquema de la \autoref{fig:rfoc_esquema_general}, el regulador de corriente entrega referencias de voltaje en el marco \(dq\). Estas referencias se transforman a \(abc\) (o a \(\alpha\beta\)) y deben aplicarse al estator. Sin embargo, el inversor tipo VSI sólo puede conmutar entre niveles discretos de tensión, por lo que se requiere un modulador que convierta esas referencias en señales de encendido/apagado para cada semiconductor.

La familia de modulación por ancho de pulso (PWM) es el enfoque dominante para esta tarea: abarca técnicas muy sencillas hasta esquemas avanzados, y su desarrollo sigue activo en la literatura reciente \cite{Bushra2024PWMReview,BenMahmoud2024SVPWMReview}. Una forma útil de organizar el tema es distinguir entre PWM convencional o carrier-based (comparación modulante–portadora), Space Vector PWM (SVPWM) y familias óptimas (por ejemplo, eliminación selectiva de armónicos).

\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\linewidth]{figuras_teoria/pwm_clasificacion_bushra.png}
	\caption{Clasificación moderna de técnicas PWM (carrier-based, SVPWM y óptimas) \cite{Bushra2024PWMReview}.}
	\label{fig:pwm_clasif_bushra}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\linewidth]{figuras_teoria/pwm_clasificacion_rashid.png}
	\caption{Esquema clásico de estrategias de conmutación PWM \cite{rashid_book}.}
	\label{fig:pwm_clasif_rashid}
\end{figure}

\paragraph{Carrier-based / convencional:}
En las técnicas carrier-based se compara una modulante (habitualmente sinusoidal por fase) con una portadora de alta frecuencia (triangular o diente de sierra) para generar los estados de los semipuentes. Destacan por su sencillez, linealidad en la región de modulación, frecuencia de conmutación fija y control directo del índice de modulación. Incluyen SPWM (senoidal pura), variantes con inyección de tercera armónica, muestreo natural o regular y extensiones a convertidores multinivel \cite{Bushra2024PWMReview}.

\paragraph{Space Vector PWM (SVPWM):}
SVPWM opera directamente en el plano \(\alpha\beta\), tratando al inversor como un generador de vectores espaciales. En cada período de conmutación selecciona secuencias de vectores activos y nulos para sintetizar el vector de referencia. En inversores de dos niveles suele ofrecer mejor utilización del bus DC (mayor amplitud máxima del voltaje fundamental), menor distorsión armónica total y control sistemático del orden de conmutaciones y de los estados nulos. Sus variantes para topologías multinivel permiten además mitigar tensión de modo común \cite{BenMahmoud2024SVPWMReview}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.75\linewidth]{figuras_teoria/svpwm.png}
	\caption{Diagrama de vector espacial y distribución de secuencia de conmutación para sector 1 \cite{BenMahmoud2024SVPWMReview}.}
	\label{fig:svpwm}
\end{figure}

\paragraph{Optimal PWM (SHE/SHM/OPP):}
Dentro de \textit{optimal PWM} se agrupan técnicas que determinan \textit{a priori} (fuera de línea) los instantes/ángulos de conmutación que optimizan un criterio (i.e. minimizar armónicos) sujeto a restricciones (número de conmutaciones, simetrías, límites de tensión/corriente) \cite{PWMreview_Wiley}. Entre las más usadas están: (i) \textit{Selective Harmonic Elimination} (SHE), que anula armónicos específicos resolviendo ecuaciones para los ángulos de disparo como función del índice de modulación; (ii) \textit{Selective Harmonic Mitigation} (SHM), que permite tolerancias no nulas en armónicos objetivo para mejorar robustez frente a variaciones del bus DC; y (iii) \textit{Optimal Pulse Patterns} (OPP), que minimizan una función de costo global (i.e. THD ponderada) y son populares en accionamientos de media/alta potencia con bajas frecuencias de conmutación. Sus ventajas típicas son muy bajo contenido armónico con pocas conmutaciones y alta eficiencia, mientras que sus limitaciones incluyen mayor complejidad de diseño (tablas e interpolación), menor ancho de banda dinámico y sensibilidad a desajustes del sistema \cite{Bushra2024PWMReview}. Estas metodologías se aplican tanto a inversores de dos niveles como multinivel, y conviven con variantes “óptimas” basadas en SVPWM reportadas en la literatura reciente \cite{BenMahmoud2024SVPWMReview}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Modulación PWM Sinusoidal (SPWM)}
Este trabajo se centra en el PWM sinusoidal (SPWM), que es parte de los PWM basados en señal portadora (CB-PWM). Este método utiliza tres señales de referencia trifásicas desfasadas \(120^\circ\), \(v_a^\ast(t)\), \(v_b^\ast(t)\) y \(v_c^\ast(t)\), junto con una señal portadora \(v_\triangle(t)\) de alta frecuencia de forma triangular o \textit{sawtooth}. En el contexto FOC, la referencia \(v_d^\ast, v_q^\ast\) debe convertirse a \(abc\) antes del modulador. Así, la conmutación por fase se define comparando cada modulante con la portadora: el interruptor superior del semipuente se enciende cuando la modulante supera a la portadora y el interruptor inferior se enciende en el instante complementario. Formalmente:

\begin{equation}
	\label{eq:spwm_sup}
	s_{x,\text{top}}(t)=
	\begin{cases}
		1, & v_x^\ast(t)>v_\triangle(t)\\
		0, & v_x^\ast(t)\le v_\triangle(t)
	\end{cases}
	\qquad x\in\{a,b,c\}
\end{equation}

De este modo se generan las seis señales de conmutación para los seis interruptores del inversor VSI de dos niveles mostrado en la \autoref{fig:inversor_rashid2}. Este esquema, si bien produce niveles discretos de voltaje, permite controlar con precisión la amplitud del fundamental trifásico sintetizado. A nivel de máquina se aplica un voltaje fase-neutro de dos niveles cuyo fundamental sigue la referencia, como se ilustra en la \autoref{fig:pwm_ejemplo_rashid}.

\medskip
\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\linewidth]{figuras_equipos/inversor_rashid.png}
	\caption{Esquema simplificado de semiconductores del inversor \cite{rashid_book}.}
	\label{fig:inversor_rashid2}
\end{figure}

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\linewidth}
		\centering
		\includegraphics[width=0.8\linewidth]{figuras_teoria/pwm_ejemploAB_rashid.png}
	\end{subfigure}\hfill
	\begin{subfigure}{0.49\linewidth}
		\centering
		\includegraphics[width=0.8\linewidth]{figuras_teoria/pwm_ejemploCD_rashid.png}
	\end{subfigure}
	\caption{Señales de conmutación y tensiones resultantes con SPWM \cite{rashid_book}.}
	\label{fig:pwm_ejemplo_rashid}
\end{figure}

\paragraph{Tiempo muerto:} En la implementación práctica de inversores de dos niveles, es común introducir un tiempo muerto entre el apagado de un interruptor y el encendido de su complemento para evitar el cortocircuito del bus DC por superposición de tiempos de conmutación y cargas de recuperación de los diodos. Este retardo, típicamente de algunos cientos de nanosegundos a pocos microsegundos según el semiconductor y la frecuencia de conmutación, reduce el ciclo útil efectivo y provoca una deformación del voltaje de fase dependiente del sentido de la corriente, generando distorsión armónica adicional y ondulación de torque a bajas velocidades.

\paragraph{Sobremodulación:} En SPWM existe una zona lineal donde la amplitud del voltaje fundamental fase-neutro generado crece proporcionalmente con la amplitud de la modulante. Al definir el índice de modulación

\begin{equation}
	\label{eq:ma_def_new}
	m_a \;=\; \frac{V_{\text{mod,pk}}}{V_{\triangle,\text{pk}}}
\end{equation}

la componente fundamental obtenida en el estator es

\begin{equation}
	\label{eq:fund_an_new}
	\hat V_{an,1} \;=\; \frac{V_{dc}}{2}\,m_a 
	\qquad \qquad \qquad
	 0\le m_a \le 1
\end{equation}

El límite superior de la región lineal se alcanza con \(m_a=1\). En ese punto, la amplitud del fundamental fase-neutro llega a la mitad del bus DC

\begin{equation}
	\label{eq:fund_half_bus}
	\hat V_{an,1}^{\max} \;=\; \frac{V_{dc}}{2}
\end{equation}

Por encima de este valor se entra en sobremodulación: aumenta la utilización del bus pero se pierde la proporcionalidad entre referencia y fundamental, además de crecer la distorsión armónica \cite{rashid_book}.

\paragraph{Frecuencia de portadora y de conmutación}
La frecuencia de la portadora \(f_c\) fija, en general, la frecuencia de conmutación efectiva de los semiconductores del inversor. En SPWM con portadora triangular centrada y comparación continua, cada semipuente conmuta aproximadamente a \(f_c\) por ciclo. Aumentar \(f_c\) desplaza el espectro de armónicos hacia frecuencias más altas y reduce su amplitud en la banda baja, lo que se traduce en menor contenido armónico en la corriente estatórica y, por ende, en un torque más limpio. No obstante, frecuencias más elevadas incrementan las pérdidas de conmutación, las exigencias térmicas y el esfuerzo EMI, por lo que la elección de \(f_c\) resulta de un compromiso entre pérdidas, rizado de corriente, requisitos acústicos y dinámica del control.

En convertidores de baja potencia con MOSFET de silicio o carburo de silicio pueden emplearse frecuencias altas, típicamente entre 20 kHz y 100 kHz. En inversores de mayor potencia (cientos de kW a algunos MW) con IGBT, son habituales rangos del orden de 2 kHz a 10 kHz. Mientras que en aplicaciones de muy alta tensión y potencia, con dispositivos como GCT, la frecuencia de conmutación suele situarse entre algunos cientos de hercios y unos pocos kilohert. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Saturación dinámica de voltaje}

El voltaje aplicado al estator de una máquina síncrona no solo se encuentra limitado por el nivel de aislamiento de los devanados, sino principalmente por el voltaje disponible en el \textit{link-DC} que alimenta al inversor y por el tipo de modulación utilizada. En el caso de la modulación sinusoidal por ancho de pulso (SPWM), la magnitud máxima de la componente fundamental del voltaje de fase no puede exceder la mitad del voltaje del bus DC:

\begin{equation}
	\label{eqn:limite_vdq_general}
	\sqrt{v_d^2 + v_q^2} \; \leq \; V_s^{\text{max}} = \dfrac{V_{DC}}{2}
\end{equation}

Este límite define una circunferencia en el plano $dq$, dentro de la cual debe ubicarse el vector de referencia $\underline{v}_{dq}$ generado por los controladores de corriente. El cumplimiento de esta restricción es fundamental para evitar saturación en el modulador y distorsiones en la corriente de fase, especialmente en condiciones de altas velocidades donde la caída por fuerza contraelectromotriz (\textit{back-EMF}) se aproxima al voltaje disponible.

\bigskip
\textbf{Saturación vectorial del voltaje.}
El primer concepto consiste en la saturación de la magnitud total del vector $\underline{v}_{dq}$, de manera que, si la magnitud $\sqrt{v_d^2 + v_q^2}$ supera el límite impuesto por el enlace DC, se realiza una reasignación proporcional (rescaling) manteniendo el mismo ángulo eléctrico. Este método conserva la dirección del fasor de voltaje, evitando cambios abruptos en el ángulo del campo girante y garantizando una transición suave entre la zona lineal y la de saturación del modulador.

\begin{equation}
	\label{eqn:saturacion_vectorial}
	(v_d^*, v_q^*) = 
	\begin{cases}
		(v_d, v_q), & \text{si } \sqrt{v_d^2 + v_q^2} \le V_s^{\text{max}} \\[6pt]
		\dfrac{V_s^{\text{max}}}{\sqrt{v_d^2 + v_q^2}} (v_d, v_q), & \text{si } \sqrt{v_d^2 + v_q^2} > V_s^{\text{max}}
	\end{cases}
\end{equation}

\bigskip
\textbf{Saturación dinámica de los lazos PI.}
El segundo concepto corresponde a la saturación dinámica aplicada a los reguladores PI de corriente en los ejes $d$ y $q$. En este caso, los límites de salida de cada PI se ajustan dinámicamente según el voltaje disponible restante en el vector de referencia. De esta forma, si el eje $q$ utiliza una fracción significativa del voltaje total (por demanda de torque), el límite del eje $d$ se reduce automáticamente para mantener la condición de saturación circular de \eqref{eqn:limite_vdq_general}.

\bigskip
Este enfoque, basado en reasignación dinámica del voltaje disponible, permite priorizar el control del componente $v_q$ (relacionado con el torque) sobre el eje $d$ (relacionado con el flujo), evitando la pérdida de linealidad del modulador sin comprometer la estabilidad de los lazos internos. El proceso se complementa con un mecanismo de \textit{anti-windup} por retrocálculo, que realimenta al integrador la diferencia entre el voltaje saturado y el solicitado, previniendo acumulación de error integral durante la saturación.

\begin{equation}
	\dot{I}_{\text{int},dq} = K_{\text{aw}} \left( v_{dq}^* - v_{dq}^{\text{PI}} \right)
\end{equation}

\bigskip
En la práctica, se adopta un margen de seguridad $\gamma \approx 0.95$ sobre el límite teórico, definiendo:
\begin{equation}
	V_s^{\text{max}} = \gamma \, \dfrac{V_{DC,\text{med}}}{2}
\end{equation}
donde $V_{DC,\text{med}}$ corresponde a la medida filtrada del bus DC. Este método ofrece una utilización óptima del voltaje disponible y una respuesta suave ante variaciones del enlace DC, siendo ampliamente preferido frente a estrategias de reparto fijo de voltaje entre ejes (\textit{fixed axis allocation}), que reducen innecesariamente el rango operativo y degradan la dinámica del control vectorial.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Debilitamiento de campo}



Al considerar la ecuación (\ref{eqn:voltaje_dq}) para la operación en estado estacionario de la máquina, se obtiene que:

\begin{equation}
	\label{eqn:voltaje_dq_estacionario}
	\begin{bmatrix}
		v_d \\ v_q
	\end{bmatrix}
	\; = \;
	R_s
	\begin{bmatrix}
		i_d \\ i_q
	\end{bmatrix}
	\, + \, 
	\omega_e \,
	\bigg(
	L_s
	\begin{bmatrix}
		-i_q \\ i_d
	\end{bmatrix}
	\, + \,
	\begin{bmatrix}
		0 \\ \psi_m
	\end{bmatrix}		
	\bigg)	
\end{equation}

Para la opración en MTPA, se tiene que:

(poner ecuación igual a la anterior pero on id=0)

Lo anterior muestra que a medida que aumenta la velocidad de giro, aumentará el back-emf de acomplamiento generado sobre el eje d, especialmente considerando que para altos torque se requiere aplicar un voltaje en el eje directo que puede llegar a ser considerable.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Implementación
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Esquema de control implementado}








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Referencias
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Referencias}
\printbibliography[heading=none]
%\printbibliography


    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Anexos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newpage
%\section{Anexos}



\end{document}