%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Iniciales
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[letterpaper, 10pt]{article}
%\usepackage{settings}
%\usepackage{./settings}
\input{settings.sty}

\addto\captionsspanish{\renewcommand{\contentsname}{Índice de contenidos}}
\addbibresource{ref.bib}

\begin{document}
\setlength{\parindent}{0cm} % Dar indentación a primera línea del parrafo
% Cambia el nombre cuadro por tabla
\renewcommand{\listtablename}{Índice de tablas} % Originalmente se llama Indice de cuadros
\renewcommand{\tablename}{Tabla} % Originalmente se llama Cuadro


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Encabezado
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Portada
\begin{titlepage}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.17\textwidth]{logo.pdf}
\end{figure}

\begin{center}
{\sc Pontificia Universidad Cat\'olica de Chile\\
Escuela de Ingenier\'ia\\
Departamento de Ingenier\'ia Eléctrica}\\
\end{center}

\phantom{""}\vspace{35mm}

\noindent\makebox[\linewidth]{\rule{\textwidth}{0.6pt}}\


\begin{center}
    \huge{\textbf{Programación de plataforma docente para accionamiento de un motor PMSM}}\\
    \noindent\makebox[\linewidth]{\rule{\textwidth}{0.6pt}}\vspace{5mm}
    \large{IEE2985 - Investigación en Pregrado}
    \vspace{10mm}
    \noindent\makebox[\linewidth]{\rule{\textwidth}{0.6pt}}
    \vspace{30mm}
\end{center}

%\begin{flushright}
\large
Alumno: Vicente Morales\\
Profesor: Javier Pereda PhD \\
Semestre: 2025-2
%\end{flushright}



\end{titlepage}
\pagebreak

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Índices
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage 
\begingroup
\hypersetup{linkcolor=black}
\tableofcontents

\newpage
\listoffigures

\bigskip
\listoftables
\endgroup

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Descripción de la investigación
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Descripción de la investigación propuesta}
El trabajo consiste en reprogramar el control de campo orientado (FOC: Field Oriented Control) de un motor PMSM que ya está implementado en una plataforma enfocada en actividades docentes. Todo el \textit{hardware} se encuentra disponible y funcionando, pero el control no funciona correctamente aún.

La programación del microcontrolador LAUNCHXL-F28379D se realiza a través del Target Support Package (extensión de PLECS Standalone que permite generar código para microcontroladores).

Plataforma de control: LAUNCHXL-F28379D
Inversor trifásico: BOOSTXL-3PhGaNInv
Motor: BLWS232D-24V-4000




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Conceptos generales
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Conceptos preliminares}

Un \textit{accionamiento eléctrico} convierte energía eléctrica en energía mecánica para realizar un trabajo útil, manteniendo bajo control el proceso de conversión \cite{FraileMora}. En su arquitectura típica (ver \autoref{fig:esquema_general}), la red alimenta a través de un convertidor electrónico a una máquina eléctrica que acciona la carga —directamente o mediante transmisión— mientras un sistema de medida realimenta variables al controlador, que actúa sobre el convertidor para satisfacer los requisitos de par y velocidad.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.65\linewidth]{figuras_preliminar/general.png}
    \caption{Arquitectura funcional de un accionamiento eléctrico \cite{FraileMora}.}
    \label{fig:esquema_general}
\end{figure}

Aunque el flujo de energía suele ir de la red a la carga (\textit{modo motor}), en numerosas aplicaciones puede invertirse para devolver energía a la fuente (\textit{modo generador}). Los accionamientos modernos emplean electrónica de potencia y control digital para regular esta conversión con alta eficiencia y respuesta dinámica.

En la automatización industrial, los \textit{variadores de velocidad} (VSD) son una pieza clave para ajustar procesos, mejorar el rendimiento y reducir consumo y costos energéticos. Entre los tipos de VSD (eléctricos, hidráulicos y mecánicos), los eléctricos destacan por su versatilidad y amplio uso en ventiladores y bombas, compresores, herramientas y robots, bancadas de prueba, papel y celulosa, tracción y propulsión naval, cementeras y trenes de laminación \cite{rashid_book}. La \autoref{fig:clasificacion_general} muestra algunas de las principales formas de clasificar los VSD eléctricos.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\linewidth]{figuras_preliminar/clasificacion_rashid.png}
    \caption{Clasificación de los VSD \cite{rashid_book}.}
    \label{fig:clasificacion_general}
\end{figure}

De la tabla, es importante tener en cuenta que el tipo de accionamiento empleado depende del tipo de motor eléctrico a controlar, dado que esto impacta sobre el tipo de convertidor electrónico empleado. Los distintos tipos de convertidores empleados para distintos tipos de máquinas tradicionalmente utilizadas en la industria se muestran en la \autoref{fig:clasificacion_convertidores}.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{figuras_preliminar/vsd_types_rashid.png}
    \caption{Tipos de convertidores electrónicos dependiendo del tipo de máquina \cite{rashid_book}.}
    \label{fig:clasificacion_convertidores}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Equipos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Equipos considerados}
El alcance de esta investigación considera el control de un motor trifásico de imanes permanentes en el rotor, accionado mediante un inversor tipo fuente de voltaje (VSI) implementado como puente trifásico con transistores MOSFET. El inversor se conecta directamente a las bobinas del estator de la máquina.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.62\linewidth]{figuras_equipos/conexion_general.png}
    \caption{Conexión entre el convertidor y la máquina estudiada}
    \label{fig:conexion_general}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\medskip
\subsection{Motor trifásico}
El motor seleccionado es un \textit{brushless DC} (BLDC) modelo BLWS232D-24V-4000 del fabricante Anaheim Automation. Es un motor síncrono con dos pares de polos, imanes permanentes en el rotor interno y bobinados del estator conectados en delta, como se muestra en la \autoref{fig:configuracion_motor}.

\bigskip
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.3\linewidth}
    \centering
    \includegraphics[width=0.85\linewidth]{figuras_equipos/BLDC_real.png}
    \caption{Motor estudiado \cite{anaheim_BLWS23_datasheet}.}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.3\linewidth}
    \centering
    \includegraphics[width=0.87\linewidth]{figuras_equipos/BLDC_esquema2.png}
    \caption{Esquema del motor de dos pares de polos \cite{twmotor_bldc_2024}.}
  \end{subfigure}
  \hfill
  \begin{subfigure}{0.3\linewidth}
    \centering
    \includegraphics[width=0.95\linewidth]{figuras_equipos/delta_connection.jpg}
    \caption{Conexión en delta de las bobinas del estator (stock).}
  \end{subfigure}
  \caption{Configuración del motor BLWS232D-24V-4000.}
  \label{fig:configuracion_motor}
\end{figure}
A continuación, se resumen los parámetros principales reportados en la hoja de datos \cite{anaheim_BLWS23_datasheet}:

\begin{multicols}{2}
\begin{itemize}
    \item Voltaje nominal: 24 [V]
    \item Velocidad nominal: 4000 [rpm]
    \item Potencia nominal: 46 [W]
    \item Torque nominal: 0.11 [N-m]
    \item Pares de polos: 2
    \item Constante de torque: 0.0387 [N-m/A]
    \item Voltaje de back-EMF: 0.004 [V/rpm]
    \item Resistencia línea - línea: 0.82 [$\Omega$]
    \item Inductancia línea - línea: 2.3 [mH]
    \item Inercia rotórica: $7.485\cdot 10^{-6}$ [N-m-s$^2$]
\end{itemize}
\end{multicols}

El motor dispone de tres terminales (A, B, C) para su alimentación y control desde el inversor.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Sensor de posición: sensor \textit{Hall}}
El motor Anaheim incorpora tres sensores Hall digitales montados a \(120^\circ\) eléctricos entre sí, solidarios al estator y enfrentados al rotor de imanes permanentes. Las tres salidas, \(\mathrm{H1}\), \(\mathrm{H2}\) y \(\mathrm{H3}\), se cablean junto con los conductores del motor, más alimentación a $5V$ y tierra (GND). Cada canal entrega una señal cuadrada compatible con lógica de $5V$.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.4\linewidth]{figuras_equipos/hall_ubicacion.jpg}
  \caption{Ubicación típica de los sensores Hall respecto del rotor (referencial).}
\end{figure}

Cada cambio de sector eléctrico (cada \(60^\circ\) eléctricos) provoca la transición de exactamente uno de los canales Hall. Comparando el estado anterior y el actual del vector \((\mathrm{H1},\mathrm{H2},\mathrm{H3})\) se determina el sentido de giro. La relación entre ángulo eléctrico \(\theta_e\) y ángulo mecánico \(\theta_m\) es
\[
\theta_e = pp \cdot \theta_m,
\]
donde \(pp\) es el número de pares de polos. Así, la medición con Hall entrega una posición absoluta \emph{por sector} con resolución de \(60^\circ\) eléctricos. Para el motor estudiado (\(p=2\)), esto equivale a \(30^\circ\) mecánicos. En total hay \(6pp\) sectores por vuelta mecánica.

\begin{table}[H]
  \centering
  \caption{Estados Hall por sector (giro \textit{CW}, visto desde el extremo del eje).}
  \label{tab:hall_cw}
  \renewcommand{\arraystretch}{1.15}
  \begin{tabular}{cccc}
    \hline
    \textbf{Ángulo eléctrico} & \textbf{H1} & \textbf{H2} & \textbf{H3} \\
    \hline
    \(0^\circ \le \theta_e < 60^\circ\)   & 0 & 1 & 0 \\
    \(60^\circ \le \theta_e < 120^\circ\) & 0 & 1 & 1 \\
    \(120^\circ \le \theta_e < 180^\circ\)& 0 & 0 & 1 \\
    \(180^\circ \le \theta_e < 240^\circ\)& 1 & 0 & 1 \\
    \(240^\circ \le \theta_e < 300^\circ\)& 1 & 0 & 0 \\
    \(300^\circ \le \theta_e < 360^\circ\)& 1 & 1 & 0 \\
    \hline
  \end{tabular}
\end{table}

La secuencia anterior es la típica para \textit{CW} \((010 \rightarrow 011 \rightarrow 001 \rightarrow 101 \rightarrow 100 \rightarrow 110)\). Si se invierte el cableado de fases o la referencia de observación, la secuencia se recorre en orden inverso para \textit{CCW}.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Sensor de posición: \textit{encoder} incremental}
Al eje del motor se acopla un \textit{encoder} incremental modelo ENC-A2I del fabricante Anaheim Automation. Este dispositivo entrega realimentación digital para control de movimiento en posición, velocidad y dirección. Emplea dos canales ópticos en cuadratura que generan señales lógicas A y B desfasadas 90° eléctricos entre sí (véase \autoref{fig:encoder_led} y \autoref{fig:encoder_senales}).

\bigskip
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/encoder_led1.png}
    %\caption{}
  \end{subfigure}\hfill
  \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/encoder_led2.png}
    %\caption{}
  \end{subfigure}
  \caption{Esquema óptico de un \textit{encoder} incremental en cuadratura \cite{fiveflute_quadrature_encoders}.}
  \label{fig:encoder_led}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.6\linewidth]{figuras_equipos/encoder_senales.png}
  \caption{Señales de salida A, B e índice \(Z\) del \textit{encoder}.}
  \label{fig:encoder_senales}
\end{figure}

 El desfase permite determinar tanto el incremento de posición como el sentido de giro al comparar el estado anterior con el estado actual de \((A,B)\). Los pulsos pueden decodificarse con una máquina de estados como la mostrada en la \autoref{fig:encoder_estados}, donde el sentido del movimiento se infiere con la transición \((A,B)_{k-1}\to(A,B)_k\). Adicionalmente, dispone de un tercer canal de índice \(Z\) que produce un pulso una vez por vuelta, útil para referenciar el ángulo cero mecánico. 

\begin{figure}[H]
  \centering
  \includegraphics[width=0.45\linewidth]{figuras_equipos/encoder_estados.png}
  \caption{Máquina de estados para decodificación de cuadratura.}
  \label{fig:encoder_estados}
\end{figure}

Los parámetros principales indicados la hoja de datos \cite{anaheim_ENC_A2I_datasheet} son los siguientes:

\begin{multicols}{2}
\begin{itemize}
  \item Cuentas por revolución (CPR): 1000.
  \item Frecuencia máx.: hasta 300.000 ciclos/s.
  \item Alimentación: 5 V nominal (rango 4.5–5.5 V).
  \item Consumo típico: 55 mA.
  \item Canales: A y B en cuadratura; canal de índice \(Z\) 1× por vuelta.
  \item Salidas lógicas tipo TTL, \emph{single-ended}:
    \begin{itemize}
      \item Nivel bajo: \(V_{\mathrm{OL}} \le 0.5\) V.
      \item Nivel alto: \(V_{\mathrm{OH}} \ge 2.0\) V.
    \end{itemize}
\end{itemize}
\end{multicols}

Como terminales, el dispositivo cuenta con cinco conexiones: alimentación (5V y GND) y tres señales de posición (A, B y I). La \autoref{fig:encoder} muestra el equipo.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.3\linewidth]{figuras_equipos/encoder.jpeg}
  \caption{Encoder incremental utilizado para el \textit{setup}.}
  \label{fig:encoder}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Inversor trifásico}
El \texttt{BOOSTXL-3PhGaNInv} es un inversor trifásico con medición de corriente de fase basada en resistencias shunt. De acuerdo con la hoja de datos, presenta las siguientes características generales:

\begin{itemize}
  \item Acepta un rango amplio de voltaje de entrada en corriente continua desde 12V hasta 60V, con un valor nominal de operación de 48V.
  \item Etapa de conversión auxiliar que utiliza el convertidor \texttt{LM5017} para generar una línea de 5V. Esta línea alimenta al módulo de compuerta \texttt{LMG5200} y sirve como referencia para la generación de 3.3V utilizados para la comunicación GPIO.
  \item Tres fases del inversor implementadas como medio puente con un módulo GaN integrado \texttt{LMG5200}, especificado para 80V y 10A. 
  \item Sensado de corriente por fase mediante una resistencias shunt de 5 m\ohm{}. La señal se amplifica con un amplificador diferencial \texttt{INA240} configurado con una ganancia de 20V/V y un \textit{offset} de 1.65V.
  \item Interruptor de temperatura \texttt{TMP302} que supervisa la temperatura de la PCB en las cercanías del módulo de potencia GaN.
  \item Protección de sobrecorriente por hardware mediante \texttt{TLV3201}, ajustado a 12A con una histéresis de 1A.
  \item El motor se conecta a un borne trifásico dedicado que proporciona las tres salidas de fase del inversor.
\end{itemize}

La tarjeta ofrece un conector de interfaz pensado para un procesador huésped. A través de este conector se gestionan señales de mando y se disponen señales de medida condicionadas por la propia placa:

\begin{itemize}
  \item Entradas PWM para los transistores de lados alto y bajo para cada una de las tres fases.
  \item Señal de habilitación de PWM (tipo \textit{active low}) que permite habilitar o deshabilitar el inversor completo.
  \item Señal acondicionada de sensado de corriente de cada fase.
  \item Señal de voltajes de fase acondicionados y filtrados mediante un filtro de pasa bajos.
  \item Señal acondicionada de voltaje del enlace DC.
  \item Señal de alerta de sobretemperatura (\textit{active low}).
\end{itemize}

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/inversor_GaN.png}
    \caption{Diagrama de bloques del BOOSTXL-3PhGaNInv.}
    \label{fig:inversor_TI}
\end{figure}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Microcontrolador}
Para implementar el sistema de control automático se utiliza la tarjeta \texttt{C2000\texttrademark\ LAUNCHXL-F28379D LaunchPad} de Texas Instruments. Mostrada en la \autoref{fig:delfino_descripcion_tarjeta}, actúa como plataforma de interfaz entre el microcontrolador \texttt{TMS320F28379D} y el resto del \textit{hardware} del accionamiento, facilitando la programación, depuración y evaluación directa desde el PC, así como la adquisición de señales de medida y el envío de señales de control.

Algunas de las principales características de la tarjeta son:

\begin{itemize}
  \item Interfaz USB para depuración y programación mediante sonda XDS100v2 aislada del resto de la tarjeta, con enlace USB/UART hacia el host.
  \item Dos LED de usuario y pulsador de \emph{reset} del dispositivo.
  \item Pines del dispositivo fácilmente accesibles para pruebas.
  \item Dos interfaces de \textit{quadrature encoder} de 5V (\(eQEP\)) expuestas en la placa.
\end{itemize}

Los distintos GPIO presentes en el pin-header se muestran en la \autoref{fig:delfino_pin_map}, con su respectivas conexiones a los periféricos del microcontrolador.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_equipos/delfino_descripcion_tarjeta.png}
    \caption{Overview de la tarjeta LAUNCHXL-F28379D \cite{ti_SPRUI77C_launchxl_overview}.}
    \label{fig:delfino_descripcion_tarjeta}
\end{figure}

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{figuras_equipos/delfino_pin_map.png}
    \caption{Pin map de la tarjeta de desarrollo \cite{ti_launchxl_f28379d_pinmap}.}
    \label{fig:delfino_pin_map}
\end{figure}

El \texttt{TMS320F28379D} integra dos CPU C28x en punto flotante a 200 MHz cada una (arquitectura de doble núcleo) y dos coprocesadores Control Law Accelerator (CLA) también a 200 MHz, lo que permite paralelizar lazos críticos y tareas auxiliares. Incorpora 1 MB de memoria flash y 204 kB de RAM, además de aceleradores de cálculo: VCU (Viterbi, aritmética compleja y CRC) y la unidad trigonométrica TMU.

Para la interfaz con el accionamiento, el dispositivo ofrece:
\begin{itemize}
  \item PWM de alta resolución: hasta 16 salidas HRPWM con control de flanco de 150 ps.
  \item Convertidores analógico–digitales: cuatro ADC con resolución seleccionable de 16 o 12 bits.
  \item Comparadores: 8 comparadores con ventana y referencias DAC internas de 12 bits.
  \item Comunicaciones serie: SCI, SPI e I\textsuperscript{2}C.
  \item Otras interfaces: CAN, McBSP y USB.
\end{itemize}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Conexión
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{PLECS Coder y Target Support Package}
La implementación y configuración de los lazos de control del motor se realiza por medio del software PLECS, de \href{https://www.plexim.com/home}{Plexim}. Este incorpora una sencilla interfaz gráfica para simular circuitos eléctricos y los respectivos controladores, en conjunto con un potente motor de cálculo optimizado para resolución de simulaciones de sistemas de potencia.

La presente sección tiene como objetivo explicar el proceso de instalación de los componentes de software mínimos, además de introducir el uso de estos para los fines requeridos en el proyecto. Notar que los manuales necesarios se pueden descargar gratuitamente en la plataforma web de \href{https://www.plexim.com/download/documentation}{Plexim}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Instalación PLECS Coder}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Instalación C2000 Target Support Package}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Configuración de Coder}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Control
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Esquema de control conceptual}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\bigskip
\subsection{Teoría del motor síncrono}
Consideremos un motor síncrono de imanes permanentes (SPMSM) con imanes de montaje superficial en un rotor cilíndrico, como en la \autoref{fig:configuracion_motor}. El estator de la máquina síncrona está conformado por tres enrrollados de fase distribuidos cuasi sinusoidalmente en la periferia del estator y desplazados espacialmente \(120^\circ\) eléctricos. La distribución idealmente sinusoidal no puede alcanzarse de forma exacta debido al número finito de ranuras, pero se diseña para aproximarla. Cada fase se conecta en serie con \(N_s\) espiras y sus conductores se alojan en ranuras del circuito magnético del estator, enfrentando el entrehierro (ver \autoref{fig:maquina_sincrona_flujos_stator}).

\medskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{figuras_teoria/maquina_sincrona_flujos_stator.png}
    \caption{Campo magnético generado por cada una de las fases del estator \cite{Vukosavic2013}.}
    \label{fig:maquina_sincrona_flujos_stator}
\end{figure}

Cada fase genera una fuerza magnetomotriz (FMM) determinada por el número de vueltas de la fase y por la corriente de fase. Cuando circulan corrientes alternas equilibradas de igual amplitud \(I_m\), frecuencia eléctrica \(\omega_e\) y desfasadas \(120^\circ\), cada fase produce una FMM sinusoidal sobre su eje magnético. Para un sistema de dos polos (extensible a \(p\) pares de polos ajustando la distribución de bobinas del estator), las FMM de fase se modelan como

\begin{equation}
\label{eqn:mmf_fases}
    \begin{aligned}
    F_a(t) &= N_s I_m \cos(\omega_e t) \\
    F_b(t) &= N_s I_m \cos\!\left(\omega_e t - \frac{2\pi}{3}\right) \\
    F_c(t) &= N_s I_m \cos\!\left(\omega_e t - \frac{4\pi}{3}\right)
    \end{aligned}
\end{equation}

Las FMM de fase \(F_a,F_b,F_c\) son magnitudes escalares definidas sobre los ejes de fase. Para describir el campo magnetizante neto en el entrehierro se utiliza el fasor espacial (o vector espacial) de la FMM, un vector en el plano del estator. Primero se obtienen las componentes en el marco estacionario \(\alpha\beta\):

\begin{equation}
    \label{eqn:clarke_F}
    \begin{bmatrix}
    F_\alpha \\[2pt] F_\beta
    \end{bmatrix}
    =
    \frac{2}{3}
    \begin{bmatrix}
    1 & -\tfrac{1}{2} & -\tfrac{1}{2}\\[2pt]
    0 & \tfrac{\sqrt{3}}{2} & -\tfrac{\sqrt{3}}{2}
    \end{bmatrix}
    \begin{bmatrix}
    F_a \\[2pt] F_b \\[2pt] F_c
    \end{bmatrix}
\end{equation}

El fasor espacial de la FMM se define como

\begin{equation}
\label{eqn:fasor_F}
    \underline{F}_S(t) \triangleq F_\alpha(t) + j\,F_\beta(t)
\end{equation}

equivalente a la forma compleja clásica

\begin{equation}
\label{eqn:fasor_F_alt}
    \underline{F}_S(t) = \frac{2}{3}\Big(F_a(t) + a\,F_b(t) + a^2\,F_c(t)\Big)
    \qquad a = e^{j\frac{2\pi}{3}}
\end{equation}

Para corrientes equilibradas, el módulo de \(\underline{F}_S\) es prácticamente constante y su argumento crece a velocidad \(\omega_e\):

\begin{equation}
\label{eqn:fasor_equilibrado}
    \big|\underline{F}_S\big| = \frac{3}{2}\,N_s I_m,
    \qquad
    \underline{F}_S(t) = \frac{3}{2}\,N_s I_m\,e^{j\omega_e t}.
\end{equation}

En el plano físico, el vector resultante de FMM del estator es

\begin{equation}
\label{eqn:F_vector}
    \vec{F}_S(t) = F_\alpha(t)\,\hat{\alpha} + F_\beta(t)\,\hat{\beta},
\end{equation}

y también puede interpretarse como la suma vectorial de las contribuciones de fase

\begin{equation}
\label{eqn:F_suma}
    \vec{F}_S(t) = \vec{F}_a(t) + \vec{F}_b(t) + \vec{F}_c(t),
\end{equation}

cuyo módulo permanece prácticamente constante y cuyo eje gira en el espacio a velocidad eléctrica \(\omega_e\). La orientación de \(\vec{F}_S\) respecto de los ejes de fase puede verse en la \autoref{fig:maquina_sincrona_flujos_stator}.

El flujo magnético estatórico se obtiene dividiendo la FMM resultante por la reluctancia magnética efectiva \(R_\mu\). Denotando por \(\vec{\Psi}_S\) al vector de enlace de flujo por vuelta del estator, se tiene

\begin{equation}
\label{eqn:psi_s}
    \vec{\Psi}_S(t) = \frac{N_s\,\vec{F}_S(t)}{R_\mu}
\end{equation}

En una máquina real, \(R_\mu\) representa la reluctancia equivalente del camino magnético hierro–entrehierro–hierro, que integra el efecto de dientes y yugo del estator, el entrehierro y las partes activas del rotor. En la práctica, el entrehierro (con \(\mu=\mu_0\)) suele dominar el valor de \(R_\mu\), mientras que ranurado, excentricidades y saturación introducen una débil dependencia con la posición. Por convenio, \(R_\mu\) se asocia al camino mutuo que acopla estator y rotor, mientras que los trayectos que no cruzan el entrehierro se modelan por separado como fugas.

Bajo esta interpretación, el flujo del estator se descompone en dos contribuciones: una componente de dispersión, que no cruza el entrehierro ni enlaza el rotor, y una componente mutua o de entrehierro, que sí lo hace y participa del acoplamiento. La suma de ambas determina el flujo total que aparece en el entrehierro.

En el rotor, los imanes permanentes generan un vector de flujo \(\vec{\Psi}_R\) fijo al rotor (ver \autoref{fig:maquina_sincrona_flujos}). El ángulo eléctrico entre \(\vec{\Psi}_S\) y \(\vec{\Psi}_R\) se denota por \(\delta\). El par electromagnético se origina por la interacción entre el flujo del rotor y la FMM/flujo del estator. En forma compacta:

\begin{equation}
\label{eqn:torque_vectorial}
    \vec{T}_{em} = k_t\, \vec{\Psi}_R \times \vec{F}_S
    \;\;\Longrightarrow\;\;
    T_{em} \propto |\vec{\Psi}_R|\,|\vec{\Psi}_S|\,\sin\delta,
\end{equation}

donde \(k_t\) es una constante constructiva. En régimen permanente, para que el par y la potencia sean constantes, la posición relativa entre \(\vec{\Psi}_S\) y \(\vec{\Psi}_R\) debe permanecer fija, lo que exige que el rotor gire en sincronismo con el campo del estator (\(\omega_m = \Omega_s\)). Este comportamiento puede visualizarse en la \autoref{fig:maquina_sincrona_flujos}, donde el vector \(\vec{F}_S\) gira a la misma velocidad que el rotor.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\linewidth]{figuras_teoria/maquina_sincrona_flujos.png}
    \caption{Flujos magnéticos presentes en la máquina síncrona \cite{Vukosavic2013}.}
    \label{fig:maquina_sincrona_flujos}
\end{figure}

La posición eléctrica y la relación entre variables mecánicas y eléctricas son:

\begin{equation}
\label{eqn:ang_elec}
    \theta_e = pp \cdot \theta_m
    \qquad \qquad \qquad
    \omega_e = \dot{\theta}_e = pp \cdot \omega_m
\end{equation}

donde \(pp\) es el número de pares de polos, \(\theta_m\) es el ángulo mecánico y \(\omega_m\) la velocidad mecánica. En consecuencia, la velocidad mecánica sincrónica es

\begin{equation}
\label{eqn:omega_sync}
    \Omega_s \;=\; \frac{\omega_e}{pp}
\end{equation}

Finalmente, nótese que para producir un \(\vec{F}_S\) de módulo casi constante que gire a \(\omega_e\) es imprescindible aplicar voltajes trifásicos sinusoidales, equilibrados y desfasados \(120^\circ\) en las bobinas del estator, lo que asegura corrientes igualmente sinusoidales y, por tanto, un campo giratorio uniforme en el entrehierro.

Por otra parte, el acoplamiento entre rotor y estator se describe con el balance de voltaje en los arrollamientos estatóricos (ver \autoref{fig:equivalente_abc}):

\begin{equation}
\label{eqn:abc_voltage}
\begin{bmatrix} v_a \\ v_b \\ v_c \end{bmatrix}
=
\begin{bmatrix} R_a & 0 & 0 \\ 0 & R_b & 0 \\ 0 & 0 & R_c \end{bmatrix}
\begin{bmatrix} i_a \\ i_b \\ i_c \end{bmatrix}
\;+\;
\frac{d}{dt}
\begin{bmatrix} \psi_a \\ \psi_b \\ \psi_c \end{bmatrix}.
\end{equation}

Los enlaces de flujo por fase se expresan como

\begin{equation}
\label{eqn:abc_flux}
    \begin{bmatrix} \psi_a \\ \psi_b \\ \psi_c \end{bmatrix}
    \; = \;
    \underbrace{\begin{bmatrix}
    L_{aa}(\theta_e) & M_{ab}(\theta_e) & M_{ac}(\theta_e)\\
    M_{ab}(\theta_e) & L_{bb}(\theta_e) & M_{bc}(\theta_e)\\
    M_{ac}(\theta_e) & M_{bc}(\theta_e) & L_{cc}(\theta_e)
    \end{bmatrix}}_{\mathbf{L}(\theta_e)}
    \begin{bmatrix} i_a \\ i_b \\ i_c \end{bmatrix}
    \;+\;
    \begin{bmatrix} \psi_{ma}(\theta_e) \\ \psi_{mb}(\theta_e) \\ \psi_{mc}(\theta_e) \end{bmatrix}
\end{equation}

donde \(L_{aa}\), \(L_{bb}\) y \(L_{cc}\) son las autoinductancias de las fases \(a\), \(b\) y \(c\), \(M_{ab}\), \(M_{ac}\), \(M_{bc}\) son las inductancias mutuas entre fases, y \(\psi_{ma}\), \(\psi_{mb}\), \(\psi_{mc}\) son los enlaces de flujo vistos por las fases debidos a los imanes permanentes. En máquinas simétricas suele cumplirse \(R_a=R_b=R_c\triangleq R_s\), \(L_{aa}=L_{bb}=L_{cc}\) y \(M_{ab}=M_{bc}=M_{ca}\), con relaciones geométricas fijadas por el desplazamiento de \(120^\circ\).

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\linewidth]{figuras_teoria/equivalente_abc.png}
    \caption{Circuito equivalente (transiente) de la máquina síncrona en referencia \textit{abc} \cite{Manias2017}.}
    \label{fig:equivalente_abc}
\end{figure}

Debido a la saturación magnética y a la construcción mecánica de la máquina síncrona de imanes permanentes, tanto las autoinductancias como las mutuas son funciones del ángulo eléctrico del rotor \(\theta_e\) (igual al ángulo síncrono). Este ángulo coincide prácticamente con la dirección del flujo del rotor (polo norte de los imanes), mientras que para \(\theta_e=0\) el eje del flujo del rotor se alinea con la fase \(a\). Por la misma razón, los enlaces de flujo de los imanes \(\psi_{m\{a,b,c\}}(\theta_e)\) dependen de \(\theta_e\).

De forma compacta, \eqref{eqn:abc_voltage}–\eqref{eqn:abc_flux} pueden escribirse como

\begin{equation}
\label{eqn:voltaje_corriente_compacto}
    \underline{v} \;=\; \mathbf{R}\,\underline{i} \;+\; \frac{d\,\underline{\lambda}}{dt}
    \qquad \qquad \qquad \qquad
    \underline{\psi} \;=\; \mathbf{L}(\theta_e)\,\underline{i} \;+\; \underline{\psi_m}(\theta_e)
\end{equation}

con \(\underline{(\cdot)}\) denotando vectores de fase en \(abc\).

Adicionalmente, de las ecuaciones (\ref{eqn:abc_voltage}) y (\ref{eqn:abc_flux}) se puede obtener una relación para el torque electromagnético:

\begin{equation}
    T_{em} \; = \; pp \cdot \bigg( \underline{i}^T \; \dfrac{d \underline{\psi_m}}{dt}(\theta_e) \, + \, \frac{1}{2} \, \underline{i}^T \dfrac{d \mathbf{L}}{d\theta_e}(\theta_e) \, \underline{i}\bigg)
\label{eqn:torque_general}
\end{equation}

De la ecuación (\ref{eqn:abc_voltage}) se puede concluir que para una ubicación fija del rotor ($\theta_e$), el valor instantáneo de la corriente estatórica $\underline{i}$ depende netamente del voltaje instantáneo ($\underline{v}$) impuesto en las bobinas. Mientras que de la ecuación (\ref{eqn:torque_general}), se obtiene que el torque instantáneo generado por el rotor depende de la corriente estatórica. Por lo tanto, se puede concluir que el torque generado por la máquina puede ser manipulado mediante un control preciso del voltaje en cada una de las fases.

Por otra parte, en lo que respecta a la dinámica de un motor sometido a un torque de carga $T_L$, esta queda controlada según la ecuación:

\begin{equation}
    T_{em} - T_L \; = \; J_m \cdot \dot{w}_m
\label{eqn:torque_equilibrio}
\end{equation}

donde $J_m$ corresponde a la inercia rotacional del rotor de la máquina. Es decir, que el motor tendrá una aceleración positiva e incrementará su velocidad en la medida que el torque generado en base a la ecuación (\ref{eqn:torque_general}) sea superior a la carga, y se frenará en el caso contrario.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Introducción al control de máquinas síncronas}

En base al análisis presentado previamente, se justifica un esquema de control de velocidad basado en el voltaje como variable manipulada en la medida de que cuenta con mediciones de velocidad angular como variable controlada. Es específico, se considera un lazo como el mostrado en la \autoref{fig:bloques_clases}, en el cual el bloque de control utiliza mediciones de corriente del motor, así como la velocidad del eje mecánico, a fin de manipular el voltaje entregado a la máquina.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{figuras_teoria/bloques_clases.png}
    \caption{Esquema básico del control de velocidad de un motor \cite{accionamientos_lesson3}.}
    \label{fig:bloques_clases}
\end{figure}

De forma más general, se suelen incluir distintos tipos de controladores en cascada con la finalidad de controlar tanto el torque generado por el motor, o bien la velocidad de operación, inclusive el ángulo mecánico del eje. Esto se muestra en la \autoref{fig:control_general_cascadas}.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.99\linewidth]{figuras_teoria/control_general_cascadas.png}
    \caption{Esquema generalizado de control de un motor síncrono en base a controladores en cascada \cite{accionamientos_lesson3}.}
    \label{fig:control_general_cascadas}
\end{figure}

Notar que, si bien los lazos de control pueden implementarse con distintos reguladores, en la práctica los VSD utilizan controladores PI debido a su sencillez, robustez y facilidad de sintonía, además de estar ampliamente validados por la experiencia práctica y ofrecer lazos usualmente estables y rápidos. Ahora bien, para que esos PI trabajen con referencias constantes y el par sea regulado con respuesta transitoria rápida, se recurre al control vectorial.

En términos generales, los métodos de control para PMSM se dividen en \textit{escalar} y \textit{vectorial} \cite{Ghassani2023_RFOC_SFOC}. El control escalar ajusta solo la amplitud y la frecuencia de los vectores espaciales de voltaje, corriente y flujo a partir de ecuaciones de régimen permanente, por lo que no actúa sobre la \textit{posición} instantánea de dichos vectores durante transitorios. Al operar en estado estacionario aparece la ley clásica \(V/f\): si el motor se alimenta desde una fuente de voltaje y se mantiene aproximadamente constante la razón entre el voltaje fundamental y la frecuencia eléctrica (\(V/\omega_e \approx \mathrm{cte}\)), el flujo de entrehierro se mantiene casi constante y el torque máximo resulta prácticamente invariante en velocidad (antes de saturar la tensión disponible del bus DC y sin debilitamiento de campo).

Despreciando la caída en \(R_s\) cerca o por sobre la frecuencia base, el par desarrollado puede obtenerse del diagrama fasorial como

\begin{equation}
\label{eq:T_V_by_omega}
    T \;\approx\; \frac{3}{\omega_e}\,\frac{E\,V}{X_s}\,\sin\delta
    \;=\; \frac{3}{\omega_e}\,\frac{E\,V}{\omega_e L_s}\,\sin\delta
\end{equation}

donde \(X_s=\omega_e L_s\), \(L_s\) es la inductancia síncrona (en SPMSM, \(L_d \approx L_q \triangleq L_s\)), \(V\) es el voltaje fundamental aplicado, \(E\) la f.e.m. inducida (con \(E=\omega_e K_e \Phi\)), y \(\delta\) el ángulo entre el vector de flujo del rotor y el vector de FMM/voltaje del estator. De la ecuación \eqref{eq:T_V_by_omega} se deduce que, manteniendo \(V/\omega_e \approx \mathrm{cte}\) y \(\delta\) casi constante, el par máximo permanece aproximadamente constante en un amplio rango de velocidades. Un ejemplo de este tipo de controlador se muestra en la \autoref{fig:pmsm_control_vf}. 

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{figuras_teoria/pmsm_control_vf.png}
    \caption{Control de lazo abierto tipo V/f para un PMSM alimentado por un inversor tipo VSI \cite{Manias2017}.}
    \label{fig:pmsm_control_vf}
\end{figure}

Esta filosofía escalar limita la respuesta dinámica al no gobernar la orientación instantánea de los vectores espaciales. En cambio, el control vectorial ajusta la magnitud, la frecuencia y también los valores instantáneos (posición) de esos vectores espaciales, lo que habilita un desempeño dinámico superior y lo ha consolidado como la estrategia de alto rendimiento para PMSM.

Dentro de la familia vectorial, coexisten enfoques con distinta implementación. El \textit{Direct Torque Control} (DTC) actúa directamente en coordenadas de vector espacial y reemplaza los reguladores de corriente por dos controladores de histéresis (bang–bang): uno sobre el módulo del flujo estatórico y otro sobre el par electromagnético. La ausencia de un modulador PWM en DTC conlleva una frecuencia de conmutación variable, lo que constituye una de sus desventajas, si bien ha sido objeto de mejoras continuas desde su introducción en 1985 \cite{Ghassani2023_RFOC_SFOC}. 

Otra línea es el \textit{Field–Oriented Control} (FOC), el enfoque del presente trabajo, que busca el desacople torque–flujo proyectando las ecuaciones de la máquina a un marco de referencia rotacional a velocidad síncrona. La filosofía es regular en lazo cerrado las componentes desacopladas de corriente, análogamente a como se realizaría para un motor DC. La orientación de la referencia rotatoria puede hacerse al flujo del rotor (\textit{RFOC}) generado por el imán permanente o al flujo del estator (\textit{SFOC}) generado por las fases eléctricas. 

En síntesis, el control vectorial regula no solo la magnitud y la frecuencia, sino también los valores instantáneos y la orientación de los vectores espaciales de voltaje, corriente y flujo, lo que habilita un desempeño dinámico superior tanto en régimen permanente como en transitorios \cite{Ghassani2023_RFOC_SFOC}. En particular, la orientación de campo permite obtener cambios (casi) instantáneos de torque, es decir, saltar directamente de un estado estacionario a otro, al imponer referencias de corriente adecuadas en el marco síncrono \cite{HughesDrury2019}. 

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{figuras_teoria/tipos_control_pmsm_review.png}
    \caption{Resumen simplificado de los tipos de controladores de máquinas síncronas \cite{Ghassani2023_RFOC_SFOC}.}
    \label{fig:tipos_control_pmsm_review}
\end{figure}



 Indeed, RFOC based on linear PI
 controllers is the most widely implemented vector controller
 in industrial applications. (paper review)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Transformación del marco de referencia: Clarke y Park}

Las variables trifásicas de la máquina (voltajes, corrientes y flujos) pueden representarse mediante \textit{vectores espaciales complejos} \cite{TI_BPRA073_1998}. Para las corrientes, el vector espacial del estator se define como

\begin{equation}
\label{eq:is_space_vector}
\underline{i}_s \;=\; \frac{2}{3}\,\big(i_a \;+\; \alpha\,i_b \;+\; \alpha^{2}\,i_c\big)
\qquad \qquad \qquad \qquad
\alpha \;=\; e^{j\frac{2\pi}{3}}
\end{equation}

donde \(\alpha\) y \(\alpha^2\) son los operadores espaciales que rotan \(120^\circ\) y \(240^\circ\) eléctricos, respectivamente. La construcción geométrica de \(\underline{i}_s\) se ilustra en la \autoref{fig:space_vector_corriente}.

\medskip
\begin{figure}[H]
  \centering
  \includegraphics[width=0.32\linewidth]{figuras_teoria/space_vector_formulacion.png}
  \caption{Vector espacial complejo de corriente del estator \(\underline{i}_s\) a partir de \(i_a,i_b,i_c\) \cite{TI_BPRA073_1998}.}
  \label{fig:space_vector_corriente}
\end{figure}

Para analizar y controlar la máquina se emplea usualmente una transformación en dos etapas (ver \autoref{fig:clarke_park_concepto}): primero se proyecta el sistema trifásico a un marco estacionario bi-axial \(\alpha\beta\), luego se rota ese marco a un sistema \(dq\) que gira a una cierta velocidad \(\omega\), según se muestra en la \autoref{fig:clarke_park_concepto}. 

\medskip
\begin{figure}[H]
  \centering
  \includegraphics[width=0.7\linewidth]{figuras_teoria/abc_dq_concepto.png}
  \caption{Esquema conceptual: \(abc\) estacionario \(\rightarrow\) \(\alpha\beta\) estacionario (Clarke) \(\rightarrow\) \(dq\) girante (Park) \cite{HughesDrury2019}.}
  \label{fig:clarke_park_concepto}
\end{figure}

\paragraph{Clarke} Como se menciona anteriormente, la Transformada de Clarke, también conocida como Transformada alfa-beta, permite representar cual conjunto trifásico balanceado \(abc\) de valores, en un par de valores en ejes ortogonales \(\alpha - \beta\). En general

\begin{equation}
\label{eq:clarke_matrix}
    \begin{bmatrix}
    i_\alpha \\[2pt] i_\beta \\[2pt] i_0
    \end{bmatrix}
    =
    K \;
    \begin{bmatrix}
    1 & -\tfrac{1}{2} & -\tfrac{1}{2}\\[2pt]
    0 & \tfrac{\sqrt{3}}{2} & -\tfrac{\sqrt{3}}{2}\\[2pt]
    \tfrac{1}{2} & \tfrac{1}{2} & \tfrac{1}{2}
    \end{bmatrix}
    \begin{bmatrix}
    i_a \\[2pt] i_b \\[2pt] i_c
    \end{bmatrix}
\end{equation}

Donde $K$ corresponde a una constante que se puede seleccionar en base al objetivo de la transformación. En su forma mas ampliamente utilizada, y la que se considera para el presente trabajo, se considera $K=2/3$. Este valor permite conservar la amplitud de las sinusoides al realizar la conversión. Adicionalmente, al considerar el sistema balanceado, se convierte en:

\begin{equation}
	\label{eq:clarke_matrix_simp}
	\begin{bmatrix}
		i_\alpha \\[2pt] i_\beta
	\end{bmatrix}
	=
	\dfrac{2}{3} \;
	\begin{bmatrix}
		1 & -\tfrac{1}{2} & -\tfrac{1}{2}\\[2pt]
		0 & \tfrac{\sqrt{3}}{2} & -\tfrac{\sqrt{3}}{2}
	\end{bmatrix}
	\begin{bmatrix}
		i_a \\[2pt] i_b \\[2pt] i_c
	\end{bmatrix}
\end{equation}

\paragraph{Park} La Transformada de Park, tambien conocida como \(dq\), permite proyectar un marco de referencia ortogonal (como el alfa-beta) sobre una referencia también ortogonal, cuyos ejes se conocen como $d$ y $q$ en referencia a la denominación de eje "directo" y eje de "cuadratura", en un ángulo \(\theta\) cualquiera, rotando a una cierta velocidad angular \(\omega\).

\begin{equation}
\label{eq:park_matrix}
    \begin{bmatrix}
    i_d \\[2pt] i_q
    \end{bmatrix}
    =
    \begin{bmatrix}
    \cos\theta & \sin\theta\\[2pt]
    -\sin\theta & \cos\theta
    \end{bmatrix}
    \begin{bmatrix}
    i_\alpha \\[2pt] i_\beta
    \end{bmatrix}
\end{equation}

\paragraph{Clarke-Park} Ambas transformaciones se pueden unificar en una única matriz de transformación:

\begin{equation}
	\label{eq:clarke_park_directa_dq}
	\begin{bmatrix}
		i_d\\[2pt]
		i_q
	\end{bmatrix}
	=
	\frac{2}{3}
	\begin{bmatrix}
		\cos\theta & \cos\!\left(\theta-\tfrac{2\pi}{3}\right) & \cos\!\left(\theta+\tfrac{2\pi}{3}\right)\\[6pt]
		-\sin\theta & -\sin\!\left(\theta-\tfrac{2\pi}{3}\right) & -\sin\!\left(\theta+\tfrac{2\pi}{3}\right)
	\end{bmatrix}
	\begin{bmatrix}
		i_a\\[2pt] i_b\\[2pt] i_c
	\end{bmatrix}.
\end{equation}


La transformación inversa ($abc \longrightarrow dq$)se obtiene invirtiendo las matriz anterior.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bigskip
\subsection{Tipos de control}



El resultado clave para control es que, al elegir \(\theta_e\) de modo que el eje \(d\) quede alineado con el vector de flujo de referencia (rotor o estator, según el esquema). 

Con esto, las señales sinusoidales equilibradas en \(abc\) pasan a ser casi constantes en \(dq\) en régimen estacionario.

\bigskip
\begin{figure}[H]
    \centering
    \includegraphics[width=0.4\linewidth]{figuras_teoria/pmsm_ab_dq_esquema_motor.png}
    \caption{Transformación a referencia rotacional de las corrientes estatóricas \cite{Quang_dittrich}.}
    \label{fig:pmsm_ab_dq_esquema_motor}
\end{figure}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Implementación
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Esquema de control implementado}








%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Referencias
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Referencias}
\printbibliography[heading=none]
%\printbibliography


    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Anexos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newpage
%\section{Anexos}



\end{document}